# DBArchiveTool

> ä¼ä¸šçº§ SQL Server æ•°æ®åº“å½’æ¡£ä¸åˆ†åŒºæ²»ç†å·¥å…·ï¼Œå›´ç»•ç°ä»£ .NET 8 æŠ€æœ¯æ ˆé‡æ„ï¼Œé¢å‘é«˜å¯é ã€é«˜æ€§èƒ½çš„æ•°æ®ç”Ÿå‘½å‘¨æœŸç®¡ç†åœºæ™¯ã€‚

## é¡¹ç›®æ¦‚è¿°
- ä»¥ SQL Server ä¸ºæ ¸å¿ƒç›®æ ‡åº“ï¼Œæä¾›æ•°æ®æºç®¡ç†ã€åˆ†åŒºå»ºæ¨¡ã€å½’æ¡£æ‰§è¡Œä¸è‡ªåŠ¨åŒ–è°ƒåº¦çš„ç«¯åˆ°ç«¯èƒ½åŠ›ã€‚
- å‰ç«¯é‡‡ç”¨ Blazor Server + Ant Design Blazorï¼Œåç«¯æ‹†åˆ†ä¸º Web APIã€åº”ç”¨æœåŠ¡ã€é¢†åŸŸæ¨¡å‹ä¸åŸºç¡€è®¾æ–½å››å±‚ï¼Œæ—¢ä¿ç•™çµæ´»æ€§ä¹Ÿä¾¿äºæ‰©å±•ã€‚
- åœ¨å…¨æ–°æ¶æ„ä¸‹æä¾›æ—¢æœ‰æ•°æ®åº“ç»“æ„çš„å…¼å®¹ä¸è¿ç§»èƒ½åŠ›ï¼Œç¡®ä¿ç°æœ‰ç”Ÿäº§ç¯å¢ƒå¯å¹³æ»‘åˆ‡æ¢ã€‚

## åŠŸèƒ½è§„åˆ’
| æ¨¡å— | æ ¸å¿ƒç›®æ ‡ | å½“å‰çŠ¶æ€ |
| --- | --- | --- |
| ç®¡ç†å‘˜ä¸å®‰å…¨åŸºçº¿ | ç®¡ç†å‘˜æ³¨å†Œã€ç™»å½•ã€å¯†ç å®‰å…¨ã€åŸºç¡€æƒé™æ§åˆ¶ | âœ… å·²å®ç°é¦–ä¸ªç®¡ç†å‘˜æ³¨å†Œ/ç™»å½•é—­ç¯ |
| å½’æ¡£ä»»åŠ¡é˜Ÿåˆ— | ç»Ÿä¸€çš„å½’æ¡£ä»»åŠ¡èšåˆæ ¹ã€å…¥é˜Ÿ APIã€çŠ¶æ€æµè½¬ | âœ… å·²æä¾›ä»»åŠ¡å…¥é˜Ÿæ¥å£ä¸å¾…å¤„ç†æŸ¥è¯¢ |
| æ•°æ®æºç®¡ç† | å¤šæ¥æº/ç›®æ ‡åº“é…ç½®ã€è¿æ¥æ ¡éªŒã€å…¼å®¹å†å²é…ç½® | ğŸ“ è§„åˆ’ä¸­ |
| åˆ†åŒºå»ºæ¨¡ | åˆ†åŒºæ–¹æ¡ˆè®¾è®¡ã€æ–‡ä»¶ç»„è§„åˆ’ã€ç´¢å¼•å…¼å®¹åˆ†æ | ğŸ“ è§„åˆ’ä¸­ |
| åˆ†åŒºç»´æŠ¤ | åˆ†åŒºå¢åˆ ã€ç©ºé—´åˆ†æã€ä¼˜åŒ–å»ºè®® | ğŸ“ è§„åˆ’ä¸­ |
| å½’æ¡£æ‰§è¡Œå¼•æ“ | åˆ†åŒºåˆ‡æ¢ã€BCP å¯¼å…¥å¯¼å‡ºã€äº‹åŠ¡å®‰å…¨ä¸å›æ»š | ğŸ“ è§„åˆ’ä¸­ |
| è‡ªåŠ¨åŒ–è°ƒåº¦ | è°ƒåº¦ç­–ç•¥ã€ä»»åŠ¡é˜Ÿåˆ—ã€é‡è¯•ä¸å‘Šè­¦ | ğŸ“ è§„åˆ’ä¸­ |
| æ‰§è¡Œæ—¥å¿—ä¸ç›‘æ§ | æ“ä½œè½¨è¿¹ã€æŒ‡æ ‡ç›‘æµ‹ã€å·®å¼‚æŠ¥å‘Š | ğŸ“ è§„åˆ’ä¸­ |

## å½“å‰è¿›åº¦
- âœ… å®Œæˆè§£å†³æ–¹æ¡ˆåˆ†å±‚æ­å»ºï¼ˆWebã€Apiã€Applicationã€Domainã€Infrastructureã€Sharedï¼‰ã€‚
- âœ… ç®¡ç†å‘˜è´¦æˆ·é¢†åŸŸæ¨¡å‹ã€å¯†ç å“ˆå¸Œä¸ APIï¼ˆæ³¨å†Œ/ç™»å½•/å­˜åœ¨æ€§æŸ¥è¯¢ï¼‰å¯ç”¨ï¼ŒBlazor ç«¯æä¾›å¯¹åº”é¡µé¢ä¸çŠ¶æ€ç®¡ç†ã€‚
- âœ… å½’æ¡£ä»»åŠ¡èšåˆæ ¹ã€EF Core ä»“å‚¨ã€åŸºç¡€ APIï¼ˆå…¥é˜Ÿã€æŸ¥è¯¢å¾…å¤„ç†ä»»åŠ¡ï¼‰å·²ç»è½åœ°ï¼Œå•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒè¡Œä¸ºã€‚
- âœ… é¦–ä¸ªæ•°æ®åº“è¿ç§»è„šæœ¬åˆ›å»º `AdminUser` ä¸ `ArchiveTask` è¡¨ï¼Œ`ArchiveDbContext` æ˜ å°„å®Œå¤‡ã€‚
- ğŸš§ å…¶ä½™æ¨¡å—æ­£æŒ‰ã€Šæ–°æ•°æ®åº“å½’æ¡£å·¥å…·-æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚æ¸…å•ã€‹æ¨è¿›ã€‚

## æŠ€æœ¯æ¶æ„
- **åç«¯**ï¼š.NET 8ã€ASP.NET Core Web APIã€EF Core 8ã€Dapperã€Microsoft.Extensions.*ã€‚
- **å‰ç«¯**ï¼šBlazor Serverã€Ant Design Blazorã€SignalRï¼ˆè®¡åˆ’ç”¨äºå®æ—¶æ¨é€ï¼‰ã€‚
- **æ•°æ®åº“**ï¼šSQL Serverï¼ˆé…ç½®ä¸å…ƒæ•°æ®åº“ï¼‰ï¼ŒRedisã€æ–‡ä»¶ç³»ç»Ÿç­‰æ‰©å±•èƒ½åŠ›é¢„ç•™ã€‚
- **æµ‹è¯•ä½“ç³»**ï¼šxUnit å•å…ƒæµ‹è¯•å·²å¯ç”¨ï¼Œé›†æˆ/E2E æµ‹è¯•éª¨æ¶å·²åˆ›å»ºå¹¶å¯æŒ‰éœ€è¡¥å……ã€‚

ç›®å½•é€Ÿè§ˆï¼š
```
DbArchiveTool/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ DbArchiveTool.Web           # Blazor Server å‰ç«¯
â”‚   â”œâ”€â”€ DbArchiveTool.Api           # REST API å±‚
â”‚   â”œâ”€â”€ DbArchiveTool.Application   # åº”ç”¨æœåŠ¡ä¸ DTO
â”‚   â”œâ”€â”€ DbArchiveTool.Domain        # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ DbArchiveTool.Infrastructure# EF Core + Dapper å®ç°
â”‚   â””â”€â”€ DbArchiveTool.Shared        # é€šç”¨ç»“æœä¸å·¥å…·
â”œâ”€â”€ tests/                          # å•å…ƒ/é›†æˆ/E2E æµ‹è¯•é¡¹ç›®
â”œâ”€â”€ Docs/                           # æ¶æ„ã€è§„èŒƒä¸éœ€æ±‚æ–‡æ¡£
â””â”€â”€ Sql/                            # å†å²æ•°æ®åº“è„šæœ¬å‚è€ƒ
```

## å¿«é€Ÿå¼€å§‹
### ç¯å¢ƒå‡†å¤‡
1. å®‰è£… [.NET 8 SDK](https://dotnet.microsoft.com/) ä¸ SQL Serverï¼ˆæˆ–å…¼å®¹å®ä¾‹ï¼‰ã€‚
2. é…ç½® `src/DbArchiveTool.Api/appsettings.json` çš„ `ConnectionStrings:ArchiveDatabase` æŒ‡å‘ç›®æ ‡æ•°æ®åº“ï¼›Blazor ç«¯è°ƒç”¨ API çš„åŸºåœ°å€ä½äº `src/DbArchiveTool.Web/appsettings.json`ã€‚

### åˆå§‹åŒ–æ•°æ®åº“
ä½¿ç”¨è¿ç§»è„šæœ¬åˆ›å»ºé¡¹ç›®æ‰€éœ€è¡¨ç»“æ„ï¼š
```powershell
cd DBManageTool
dotnet ef database update --project src/DbArchiveTool.Infrastructure --startup-project src/DbArchiveTool.Api
```
> å¦‚éœ€è‡ªå®šä¹‰è¿æ¥å­—ç¬¦ä¸²ï¼Œè¯·åœ¨æ‰§è¡Œå‰ä¿®æ”¹ `appsettings.json` æˆ–é€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–ã€‚

### æ„å»ºä¸è¿è¡Œ
```powershell
cd DBManageTool
dotnet restore
dotnet build
# å¯åŠ¨ APIï¼ˆé»˜è®¤ http://localhost:5083/ æˆ– https://localhost:5001/ï¼‰
dotnet run --project src/DbArchiveTool.Api
# åœ¨æ–°çš„ç»ˆç«¯å¯åŠ¨ Blazor å‰ç«¯
dotnet run --project src/DbArchiveTool.Web
```

### æµ‹è¯•
```powershell
cd DBManageTool
dotnet test
```
é›†æˆä¸ E2E æµ‹è¯•å·²è®¾ç½®éª¨æ¶ï¼Œéƒ¨åˆ†ç”¨ä¾‹å› ä¾èµ–å®Œæ•´åç«¯æµç¨‹è€Œæš‚æ—¶ `Skip`ï¼Œå¯åœ¨ç›¸å…³æ¨¡å—å®ç°åå¯ç”¨ã€‚

## è®¸å¯è¯
æœ¬é¡¹ç›®éµå¾ª [LICENSE](LICENSE) ä¸­çš„å¼€æºè®¸å¯åè®®ã€‚