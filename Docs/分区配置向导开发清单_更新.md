# åˆ†åŒºé…ç½®å‘å¯¼å¼€å‘å‰©ä½™æ¸…å•

> æœ€åæ›´æ–°ï¼š2025-10-12  
> è¯´æ˜ï¼šä»¥ä¸‹ä»»åŠ¡åŸºäºå½“å‰å·²å®Œæˆçš„å·¥ä½œï¼ˆå…ƒæ•°æ®æŸ¥è¯¢ APIã€è¿æ¥å·¥å‚æ‰©å±•ç­‰ï¼‰æ•´ç†ã€‚åˆ—è¡¨æŒ‰æ¨¡å—æ‹†åˆ†ï¼Œä¾¿äºè¿­ä»£è·Ÿè¸ªã€‚

---


## æ–°å¢è¿›å±•ï¼ˆ2025-10-12ï¼‰
- å®Œæˆåˆ†åŒºæ‰§è¡Œæƒé™æ£€æŸ¥é“¾è·¯ï¼šæ–°å¢ `PartitionPermissionRequirement`ã€`IPermissionInspectionRepository`ã€`SqlServerPermissionInspectionRepository`ï¼Œ`PartitionExecutionAppService` åœ¨ä»»åŠ¡åˆ›å»ºå‰é˜»æ–­ç¼ºå¤±æƒé™æƒ…å½¢å¹¶å†™å…¥æ—¥å¿—ã€‚
- æ›´æ–°æ–‡æ¡£ä¸ TODO åˆ—è¡¨ï¼ŒTask 8ï¼ˆæƒé™ä¸ç¯å¢ƒæ ¡éªŒï¼‰å…¨éƒ¨å®Œæˆï¼Œå¼€å§‹æ¨è¿›å¤‡ä»½æ£€æŸ¥ä¸ Processor ä¸»çº¿ã€‚
- å°† `PartitionExecutionProcessor` çš„åå°æƒé™æ ¡éªŒæ”¹ä¸ºå¤ç”¨ `SqlServerPermissionInspectionRepository`ï¼Œå‰åå°ç»Ÿä¸€é’ˆå¯¹æºæ•°æ®åº“æ‰§è¡Œ `fn_my_permissions` æ£€æŸ¥ï¼Œå¹¶æ¸…ç†å†å² `PermissionCheck.sql` æ¨¡æ¿çš„ä¾èµ–ï¼ˆä¿ç•™ç©ºæ–‡ä»¶æ³¨æ˜å·²å¼ƒç”¨ï¼‰ï¼ŒåŒæ—¶åœ¨æ—¥å¿—ä¸­è¾“å‡ºæœåŠ¡å™¨/æ•°æ®åº“/å¯¹è±¡ä¸Šä¸‹æ–‡ï¼Œä¾¿äºæ’æŸ¥ã€‚

## å†å²è¿›å±•ï¼ˆ2025-10-10ï¼‰
- å®Œæˆåˆ†åŒºæ‰§è¡Œä»»åŠ¡/æ—¥å¿—é¢†åŸŸæ¨¡å‹åŠ EF æ˜ å°„ï¼Œå¹¶æ–°å¢ `20251010085828_AddPartitionExecutionTables` è¿ç§»ã€‚
- å®ç°æ‰§è¡Œä»»åŠ¡ä»“å‚¨ã€å†…å­˜é˜Ÿåˆ—ã€æ´¾å‘å™¨ä¸ `PartitionExecutionHostedService` å ä½é€»è¾‘ï¼Œæ–°å¢ `PartitionExecutionProcessor`ã€‚
- æ–°å¢ `PartitionExecutionAppService`ã€`PartitionExecutionsController` ä¸å‰ç«¯ `PartitionExecutionApiClient`ï¼Œæ”¯æŒä»»åŠ¡åˆ›å»º/æŸ¥è¯¢/æ—¥å¿—åŸºç¡€èƒ½åŠ›ã€‚
- æ¢å¤ `Partitions.razor` åŸå§‹ç»“æ„ï¼Œä¸ºåç»­æ‰§è¡Œç›‘æ§ UI æ”¹é€ ä¿ç•™åŸºçº¿ã€‚

## ğŸ“Š å½“å‰è¿›åº¦æ€»è§ˆ

### âœ… å·²å®Œæˆï¼ˆPhase 1 - åˆ†åŒºé…ç½®å‘å¯¼ï¼‰
- **åç«¯**ï¼šé¢†åŸŸæ¨¡å‹ã€åº”ç”¨æœåŠ¡ã€API æ§åˆ¶å™¨ã€æ•°æ®æŒä¹…åŒ–
- **å‰ç«¯**ï¼šé…ç½®å‘å¯¼ UIï¼ˆä¸‰æ­¥éª¤ï¼šåŸºç¡€ä¿¡æ¯ã€åˆ†åŒºå€¼ã€å®Œæˆï¼‰ã€### 1.1 PartitionC### 1.3 åº”ç”¨æœåŠ¡
   - [x] å®ç° `Pa### 1.4 API æ§åˆ¶å™¨
   - [x] åˆ›### 2.1 æ•°æ®æŒä¹…åŒ–
   - [x] æ›´æ–° EF å®ä½“ä¸ DbContext æ˜ å°„(PartitionConfigurationsã€PartitionValues)### 3.3 API å®¢æˆ·ç«¯
   - [x] åˆ›å»º Par### 4.1 å•å…ƒæµ‹è¯•
   - [x] PartitionConfiguration é¢†åŸŸé€»è¾‘æµ‹è¯•
   - [x] PartitionConfigurationAppService æ ¡éªŒé€»è¾‘æµ‹è¯•
   - [x] **æ–°å¢ UpdateAsync å®Œæ•´æµ‹è¯•ç”¨ä¾‹**(2025-10-10)
     - [x] UpdateAsync_ShouldFail_WhenConfigurationMissing
     - [x] UpdateAsync_ShouldFail_WhenConfigurationCommitted
     - [x] UpdateAsync_ShouldFail_WhenTableAlreadyPartitioned
     - [x] UpdateAsync_ShouldSucceed_WhenValid
   - [x] **æ–°å¢ GetAsync æµ‹è¯•ç”¨ä¾‹**(2025-10-10)
     - [x] GetAsync_ShouldFail_WhenConfigurationMissing
     - [x] GetAsync_ShouldReturnDetail_WhenFound
   - [ ] **PartitionCommand é¢†åŸŸé€»è¾‘æµ‹è¯•**(çŠ¶æ€æœºã€å·¥å‚æ–¹æ³•)
   - [ ] **PartitionCommandAppService æµ‹è¯•**(é¢„è§ˆã€æ‰§è¡Œã€å®¡æ‰¹)
   - [ ] **SqlTemplateProvider æµ‹è¯•**(æ¨¡æ¿æ¸²æŸ“ã€å‚æ•°æ›¿æ¢)ConfigurationApiClient
   - [x] ä¿®å¤ JSON åºåˆ—åŒ–é…ç½®
   - [x] **å®ç° GetAsync è·å–é…ç½®è¯¦æƒ…**(2025-10-10)
   - [x] **å®ç° UpdateAsync æ›´æ–°é…ç½®**(2025-10-10)
   - [x] **æ–°å¢ PartitionConfigurationDetailModel**(2025-10-10)
   - [x] **æ–°å¢ UpdatePartitionConfigurationRequestModel**(2025-10-10)
   - [ ] **æ‰©å±• PartitionCommandApiClient**:
     - [ ] PreviewSplit/ExecuteSplit æ–¹æ³•
     - [ ] PreviewMerge/ExecuteMerge æ–¹æ³•
     - [ ] PreviewSwitch/ExecuteSwitch æ–¹æ³•
     - [ ] GetCommandStatus æ–¹æ³•
     - [ ] Approve/Reject æ–¹æ³• ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬
   - [x] ä¿®å¤ SQL åˆ—åé”™è¯¯(`range_type` â†’ `boundary_value_on_right`)
   - [x] **åˆ›å»º AddPartitionConfigurationCommitted è¿ç§»**(2025-10-10)
   - [x] **PartitionConfigurationEntity æ–°å¢ IsCommitted å­—æ®µ**(2025-10-10)
   - [x] **PartitionConfigurationRepository æ˜ å°„ IsCommitted**(2025-10-10)
   - [ ] **æ‰§è¡Œæ•°æ®åº“è¿ç§»(dotnet ef database update)**
   - [ ] **åˆ›å»º PartitionCommand å®ä½“æ˜ å°„ä¸è¿ç§»**
   - [ ] **åˆ›å»º PartitionCommandRepository å®ç°**titionConfigurationsController`(åˆ›å»ºé…ç½®/æ›´æ–°åˆ†åŒºå€¼)
   - [x] åˆ›å»º `PartitionCommandsController` åŸºç¡€ç»“æ„
   - [x] **æ–°å¢ GET /api/v1/partition-configurations/{id} è·å–é…ç½®è¯¦æƒ…**(2025-10-10)
   - [x] **æ–°å¢ PUT /api/v1/partition-configurations/{id} æ›´æ–°é…ç½®**(2025-10-10)
   - [x] **æ–°å¢ UpdatePartitionConfigurationDto**(2025-10-10)
   - [ ] **å®ç° PartitionCommandsController å®Œæ•´ç«¯ç‚¹**:
     - [ ] POST `.../split/preview` å’Œ `.../split/execute`
     - [ ] POST `.../merge/preview` å’Œ `.../merge/execute`
     - [ ] POST `.../switch/preview` å’Œ `.../switch/execute`
     - [ ] GET `/api/v1/partition-commands/{commandId}` çŠ¶æ€æŸ¥è¯¢
     - [ ] POST `/api/v1/partition-commands/{commandId}/approve|reject`
   - [ ] **è¡¥å…… XML æ³¨é‡Šä¸ ProducesResponseType å£°æ˜**figurationAppService`(åˆ›å»ºé…ç½®ã€æ·»åŠ åˆ†åŒºå€¼)
   - [x] è¾“å‡º `CreatePartitionConfigurationRequest` / `ReplacePartitionValuesRequest` DTO
   - [x] **å®ç° GetAsync è·å–é…ç½®è¯¦æƒ…**(2025-10-10)
   - [x] **å®ç° UpdateAsync æ›´æ–°é…ç½®åŸºç¡€ä¿¡æ¯**(2025-10-10)
   - [x] **æ–°å¢ UpdatePartitionConfigurationRequest DTO**(2025-10-10)
   - [x] **æ–°å¢ PartitionConfigurationDetailDto**(2025-10-10)
   - [x] **ReplaceValuesAsync/DeleteAsync å¢åŠ  IsCommitted æ ¡éªŒ**(2025-10-10)
   - [ ] **å®ç° `PartitionCommandAppService` å®Œæ•´åŠŸèƒ½**:
     - [ ] PreviewSplitAsync / ExecuteSplitAsync
     - [ ] PreviewMergeAsync / ExecuteMergeAsync
     - [ ] PreviewSwitchAsync / ExecuteSwitchAsync
     - [ ] GetStatusAsync(å‘½ä»¤çŠ¶æ€æŸ¥è¯¢)
     - [ ] ApproveAsync / RejectAsync(å®¡æ‰¹æµç¨‹)
   - [ ] **å®šä¹‰ Split/Merge/Switch è¯·æ±‚ DTO**
   - [ ] **å®šä¹‰ PartitionCommandPreviewDto(å«è„šæœ¬ã€é£é™©ã€Hash)**
   - [ ] **å®šä¹‰ PartitionCommandStatusDto** é¢†åŸŸæ‰©å±•
   - [x] æ”¯æŒå­˜æ”¾æ¨¡å¼ã€æ–‡ä»¶ç›®å½•ã€æ–‡ä»¶å¤§å°ã€ç›®æ ‡è¡¨åã€å¤‡æ³¨ç­‰å±æ€§
   - [x] å¢åŠ å¿…è¦çš„ä¸šåŠ¡è§„åˆ™:ç›®æ ‡è¡¨å‘½åæ ¡éªŒã€å•æ–‡ä»¶ç»„å‚æ•°éªŒè¯ã€åˆ†åŒºåˆ— NOT NULL è¦æ±‚ç­‰
   - [x] å®ç°åˆ†åŒºå€¼æ‰¹é‡æ›¿æ¢é€»è¾‘ä¸è¾¹ç•ŒéªŒè¯
   - [x] **æ–°å¢ IsCommitted æ‰§è¡ŒçŠ¶æ€æ ‡è®°**(2025-10-10)
   - [x] **æ–°å¢ MarkCommitted/MarkDraft çŠ¶æ€ç®¡ç†æ–¹æ³•**(2025-10-10)/å¹´ç”Ÿæˆ
- **ä¿®å¤**ï¼šSQL åˆ—åé”™è¯¯ã€JSON æšä¸¾åºåˆ—åŒ–ã€Context å†²çªã€æ—¥æœŸé€‰æ‹©ä¼˜åŒ–

### 3.1 åˆ†åŒºé…ç½®å‘å¯¼(Phase 1 - âœ… å·²å®Œæˆ 98%)
   - [x] å®ç°æŠ½å±‰ + Steps(åŸºç¡€ä¿¡æ¯ / åˆ†åŒºå€¼ / å®Œæˆ)
   - [x] å¤„ç†è¡¨é€‰æ‹©ã€åˆ—ä¿¡æ¯åŠ è½½ã€åˆ—ç»Ÿè®¡å±•ç¤ºã€ç›®æ ‡åº“ä¸‹æ‹‰
   - [x] å®ç°å¤šæ­¥éª¤æ ¡éªŒ(å¿…é€‰é¡¹ã€æ ¼å¼ã€æ–‡ä»¶å¤§å°ã€åˆ†åŒºå€¼æ’åº)
   - [x] è°ƒç”¨æ–°å»ºé…ç½® / ä¿å­˜åˆ†åŒºå€¼ API
   - [x] ä¼˜åŒ–æ—¥æœŸé€‰æ‹©å™¨(æŒ‰æœˆ/æŒ‰å¹´é€‰æ‹©)
   - [x] ä¿®å¤ Context å‚æ•°å†²çªä¸ JSON åºåˆ—åŒ–é—®é¢˜
   - [x] **ä¿®å¤åˆ†åŒºåˆ—ä¸‹æ‹‰æ¡†çŠ¶æ€æ¸…ç†é—®é¢˜**(2025-10-10)
   - [x] **å®ç°æ•°æ®ç›®å½•è‡ªåŠ¨è·å–ä¸ç¼“å­˜**(2025-10-10)
   - [x] **å®ç°æ–‡ä»¶åè·Ÿéšæ–‡ä»¶ç»„åç§°è‡ªåŠ¨æ›´æ–°**(2025-10-10)
   - [x] **å®ç°åˆ—ç»Ÿè®¡æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–æ˜¾ç¤º**(2025-10-10)
   - [x] **å®ç°åˆ†åŒºé…ç½®è‰ç¨¿ç¼–è¾‘åŠŸèƒ½**(2025-10-10)
     - [x] å‘å¯¼æ”¯æŒç¼–è¾‘æ¨¡å¼(åŠ è½½ç°æœ‰é…ç½®ã€ç¦ç”¨ä¸å¯å˜å­—æ®µ)
     - [x] å·²æ‰§è¡Œé…ç½®é”å®šä¿æŠ¤(IsCommitted æ ¡éªŒ)
     - [x] å·²åˆ†åŒºè¡¨æ–¹æ¡ˆä¿®æ”¹é™åˆ¶(å…ƒæ•°æ®æ ¡éªŒ)
     - [x] é…ç½®åˆ—è¡¨ç¼–è¾‘å…¥å£ä¸çŠ¶æ€ç®¡ç†
   - [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»(AddPartitionConfigurationCommitted)
   - [ ] æ‰‹åŠ¨æµ‹è¯•ç¼–è¾‘åŠŸèƒ½å®Œæ•´æµç¨‹
   - [ ] è¡¥å……é›†æˆæµ‹è¯•(API ç«¯åˆ°ç«¯æµ‹è¯•)
   - [ ] æ›´æ–°ç”¨æˆ·æ“ä½œæ‰‹å†Œ(æ–°å¢ç¼–è¾‘æµç¨‹è¯´æ˜)ase 2 - åˆ†åŒºæ“ä½œå‘½ä»¤ï¼‰
- *### ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶(2025-10-10)
1. `PartitionInfoController.cs` - æ·»åŠ  3 ä¸ªæ–°çš„é€šç”¨ API ç«¯ç‚¹(`~/api/v1/data-sources/{id}/tables`)
2. `SqlPartitionQueryService.cs` - æ·»åŠ  `GetDatabaseTablesAsync` æ–¹æ³•å’Œ `DatabaseTableDto`
3. `PartitionInfoApiClient.cs` - æ·»åŠ  `GetDatabaseTablesAsync` æ–¹æ³•,ä¿®æ­£ API è·¯å¾„
4. `Partitions.razor` - ä¸»è¦ä¼˜åŒ–:
   - ä¿®æ”¹äº‹ä»¶å¤„ç†å™¨ä¸º `HandleSourceTableChanged/HandlePartitionColumnChanged`
   - æ·»åŠ  `CachedDefaultFileDirectory` ç¼“å­˜å­—æ®µ
   - æ·»åŠ  `HandleFilegroupNameChanged` å’Œ `RegenerateDataFileName` æ–¹æ³•
   - æ·»åŠ  `FormatColumnStatValue` æ–¹æ³•
   - ä¼˜åŒ– `ApplyStorageModeDefaults` é€»è¾‘(æ£€æµ‹æ–‡ä»¶ç»„åç§°å˜åŒ–)

### 2025-10-10 ç¬¬äºŒæ¬¡æ›´æ–° - åˆ†åŒºé…ç½®è‰ç¨¿ç¼–è¾‘åŠŸèƒ½ âœ¨
**åŠŸèƒ½æ¦‚è¿°**: æ”¯æŒåœ¨è‰ç¨¿é˜¶æ®µä¿®æ”¹åˆ†åŒºé…ç½®çš„åŸºç¡€ä¿¡æ¯(å­˜å‚¨æ¨¡å¼ã€ç›®æ ‡è¡¨ç­‰),å·²æ‰§è¡Œé…ç½®è‡ªåŠ¨é”å®šé˜²æ­¢è¯¯ä¿®æ”¹

#### åç«¯å®ç°

**1. é¢†åŸŸå±‚ (Domain)**
- `PartitionConfiguration.cs`:
  - æ–°å¢ `IsCommitted` å±æ€§ - æ ‡è®°é…ç½®æ˜¯å¦å·²æ‰§è¡Œ
  - æ–°å¢ `MarkCommitted(user)` æ–¹æ³• - æ ‡è®°ä¸ºå·²æ‰§è¡ŒçŠ¶æ€
  - æ–°å¢ `MarkDraft(user)` æ–¹æ³• - æ¢å¤ä¸ºè‰ç¨¿çŠ¶æ€(ç”¨äºæ’¤é”€åœºæ™¯)
  - æ„é€ å‡½æ•°æ–°å¢ `isCommitted` å‚æ•°

**2. åŸºç¡€è®¾æ–½å±‚ (Infrastructure)**
- **æ•°æ®åº“è¿ç§»**: `20251010043019_AddPartitionConfigurationCommitted.cs`
  - åœ¨ `PartitionConfiguration` è¡¨æ·»åŠ  `IsCommitted` åˆ—(bit, é»˜è®¤ false)
- `PartitionConfigurationEntity.cs`: æ–°å¢ `IsCommitted` å±æ€§
- `ArchiveDbContext.cs`: é…ç½® `IsCommitted` å­—æ®µé»˜è®¤å€¼
- `PartitionConfigurationRepository.cs`:
  - `MapToEntity()` æ˜ å°„ `IsCommitted` å­—æ®µ
  - `MapToDomain()` è¿˜åŸ `isCommitted` å‚æ•°
  - ä¿æŒ `AsNoTracking` + `ChangeTracker.Clear` æ¨¡å¼é˜²æ­¢è·Ÿè¸ªå†²çª

**3. åº”ç”¨å±‚ (Application)**
- `IPartitionConfigurationAppService.cs`:
  - æ–°å¢ `GetAsync(configurationId)` - è·å–é…ç½®è¯¦æƒ…
  - æ–°å¢ `UpdateAsync(configurationId, request)` - æ›´æ–°é…ç½®åŸºç¡€ä¿¡æ¯
- æ–°å¢ DTOs:
  - `UpdatePartitionConfigurationRequest` - æ›´æ–°è¯·æ±‚(å­˜å‚¨æ¨¡å¼ã€ç›®æ ‡è¡¨ç­‰)
  - `PartitionConfigurationDetailDto` - è¯¦æƒ…è¿”å›(å«åˆ†åŒºå€¼åˆ—è¡¨ã€å…ƒæ•°æ®çŠ¶æ€)
- `PartitionConfigurationSummaryDto`: æ–°å¢ `IsCommitted` å­—æ®µ
- `PartitionConfigurationAppService.cs`:
  - å®ç° `GetAsync()` - æŸ¥è¯¢é…ç½®è¯¦æƒ…,åŒ…å«å…ƒæ•°æ®åˆ¤æ–­
  - å®ç° `UpdateAsync()` - å®Œæ•´æ›´æ–°é€»è¾‘:
    - å·²æ‰§è¡Œé…ç½®ä¸å¯ä¿®æ”¹æ ¡éªŒ
    - å·²åˆ†åŒºè¡¨ä¸å¯ä¿®æ”¹æ–¹æ¡ˆæ ¡éªŒ(é€šè¿‡å…ƒæ•°æ®æŸ¥è¯¢)
    - å­˜å‚¨è®¾ç½®æ›´æ–°(`UpdateStorageSettings`)
    - ç›®æ ‡è¡¨æ›´æ–°(`UpdateTargetTable`)
  - `ReplaceValuesAsync()` æ–°å¢å·²æ‰§è¡Œæ ¡éªŒ
  - `DeleteAsync()` æ–°å¢å·²æ‰§è¡Œæ ¡éªŒ
  - é‡æ„ `BuildStorageSettings()` ä¸ºé™æ€æ–¹æ³•ä»¥æ”¯æŒåˆ›å»º/æ›´æ–°å¤ç”¨

**4. API å±‚**
- `PartitionConfigurationsController.cs`:
  - `GET /api/v1/partition-configurations/{id}` - è·å–é…ç½®è¯¦æƒ…
  - `PUT /api/v1/partition-configurations/{id}` - æ›´æ–°é…ç½®åŸºç¡€ä¿¡æ¯
- `PartitionConfigurationDtos.cs`:
  - æ–°å¢ `UpdatePartitionConfigurationDto` - APIè¯·æ±‚æ¨¡å‹

#### å‰ç«¯å®ç°

**5. Web å±‚ (Blazor UI)**
- `PartitionConfigurationApiClient.cs`:
  - æ–°å¢ `GetAsync(configurationId)` æ–¹æ³•
  - æ–°å¢ `UpdateAsync(configurationId, request)` æ–¹æ³•
- `PartitionConfigurationRequests.cs`:
  - æ–°å¢ `UpdatePartitionConfigurationRequestModel`
  - æ–°å¢ `PartitionConfigurationDetailModel`
  - `PartitionConfigurationSummaryModel` æ–°å¢ `IsCommitted` å­—æ®µ

**6. åˆ†åŒºé…ç½®å‘å¯¼ç»„ä»¶ (PartitionConfigWizard)**
- `PartitionConfigWizard.razor`:
  - Drawer æ–°å¢ `Closable=true` å’Œ `MaskClosable=false`
  - æ–°å¢ `HandleDrawerClose()` äº‹ä»¶å¤„ç†
  - æºè¡¨å’Œåˆ†åŒºåˆ—ä¸‹æ‹‰æ¡†åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹ç¦ç”¨(`Disabled=@IsEditing`)
  - å®Œæˆæ­¥éª¤æ ‡é¢˜æ ¹æ®æ¨¡å¼åŠ¨æ€æ˜¾ç¤º("åˆ›å»ºæˆåŠŸ"/"æ›´æ–°æˆåŠŸ")
- `PartitionConfigWizard.razor.cs`:
  - æ–°å¢å‚æ•°:
    - `IsEditMode` - æ˜¯å¦ä¸ºç¼–è¾‘æ¨¡å¼
    - `EditingConfigurationId` - ç¼–è¾‘çš„é…ç½®ID
    - `EditingConfiguration` - ç¼–è¾‘çš„é…ç½®è¯¦æƒ…
  - æ–°å¢ `InitializeWizardForEditAsync()` æ–¹æ³•:
    - åŠ è½½ç°æœ‰é…ç½®çš„æ‰€æœ‰å­—æ®µ
    - æ¢å¤åˆ†åŒºè¾¹ç•Œå€¼åˆ—è¡¨
    - æ¢å¤å­˜å‚¨è®¾ç½®å’Œç›®æ ‡è¡¨ä¿¡æ¯
  - `SubmitAsync()` é‡æ„:
    - åŒºåˆ†åˆ›å»º/æ›´æ–°ä¸¤ç§æ¨¡å¼
    - åˆ›å»ºæ¨¡å¼: å…ˆ CreateAsync å† ReplaceValuesAsync
    - æ›´æ–°æ¨¡å¼: å…ˆ UpdateAsync å† ReplaceValuesAsync
    - ä½¿ç”¨å·²æœ‰çš„ `ConfigurationId` (ç¼–è¾‘æ¨¡å¼)

**7. åˆ†åŒºç®¡ç†é¡µé¢ (Partitions.razor)**
- **é…ç½®è‰ç¨¿è¡¨æ ¼å¢å¼º**:
  - æ–°å¢ `IsCommitted` å’Œ `IsPartitioned` å­—æ®µè®¡ç®—
  - æ–°å¢è¡Œé€‰æ‹©æ”¯æŒ(`@bind-SelectedRows`, `_selectedDraft`, `_selectedDraftRows`)
  - æ–°å¢"ç¼–è¾‘"æŒ‰é’®åˆ—(åªå¯¹æœªæ‰§è¡Œä¸”æœªåˆ†åŒºçš„è‰ç¨¿å¯ç”¨)
  - åˆ é™¤æŒ‰é’®åŒæ­¥ç¦ç”¨è§„åˆ™
- **ç¼–è¾‘åŠŸèƒ½å…¥å£**:
  - æ–°å¢ `EditConfigurationDraftAsync(draft)` æ–¹æ³•:
    - è°ƒç”¨ `GetAsync()` è·å–è¯¦ç»†ä¿¡æ¯
    - äºŒæ¬¡æ ¡éªŒ `IsCommitted` å’Œ `SourceTableIsPartitioned`
    - è®¾ç½®ç¼–è¾‘æ¨¡å¼å‚æ•°å¹¶æ‰“å¼€å‘å¯¼
  - æ–°å¢ `EditSelectedDraftAsync()` æ–¹æ³•(æ”¯æŒä¿®æ”¹æŒ‰é’®è°ƒç”¨)
  - æ–°å¢ `CanEditDraft` è®¡ç®—å±æ€§
- **çŠ¶æ€ç®¡ç†**:
  - æ–°å¢å­—æ®µ: `_editingConfigurationId`, `_editingConfigurationDetail`, `_partitionConfigWizardIsEdit`
  - `LoadConfigurationDraftsAsync()` å¢å¼º:
    - è®¡ç®— `IsPartitioned` (é€šè¿‡ `_partitionTables` æŸ¥æ‰¾)
    - åˆ·æ–°åä¿æŒé€‰ä¸­çŠ¶æ€
  - `OnTabChanged()` åˆ‡æ¢æ—¶æ¸…ç©ºé€‰ä¸­è‰ç¨¿
  - `DeleteConfigurationDraftAsync()` åˆ é™¤åæ¸…ç©ºé€‰ä¸­
  - `OnPartitionConfigCompletedAsync()` å®Œæˆåæ¸…ç©ºç¼–è¾‘çŠ¶æ€
- **UI äº¤äº’ä¼˜åŒ–**:
  - `OnDraftRowClick()` - è¡Œç‚¹å‡»é€‰ä¸­
  - `GetDraftRowClass()` - é€‰ä¸­è¡Œé«˜äº®æ ·å¼
  - `HandlePartitionWizardVisibleChanged()` - å…³é—­æ—¶æ¸…ç©ºç¼–è¾‘çŠ¶æ€

**8. é…ç½®è‰ç¨¿è¡¨æ•°æ®æ¨¡å‹**
- `ConfigurationDraftInfo`:
  - æ–°å¢ `IsCommitted` - æ˜¯å¦å·²æ‰§è¡Œ
  - æ–°å¢ `IsPartitioned` - æºè¡¨æ˜¯å¦å·²åˆ†åŒº(é€šè¿‡å…ƒæ•°æ®åˆ¤æ–­)

#### æµ‹è¯•å®Œå–„

**9. å•å…ƒæµ‹è¯• (UnitTests)**
- `PartitionConfigurationAppServiceTests.cs`:
  - æ–°å¢ `UpdateAsync_ShouldFail_WhenConfigurationMissing` âœ…
  - æ–°å¢ `UpdateAsync_ShouldFail_WhenConfigurationCommitted` âœ…
  - æ–°å¢ `UpdateAsync_ShouldFail_WhenTableAlreadyPartitioned` âœ…
  - æ–°å¢ `UpdateAsync_ShouldSucceed_WhenValid` âœ…
  - æ–°å¢ `GetAsync_ShouldFail_WhenConfigurationMissing` âœ…
  - æ–°å¢ `GetAsync_ShouldReturnDetail_WhenFound` âœ…
  - ä¿®å¤ `CreateAsync_ShouldSucceed_WhenMetadataUnavailable` (ç§»é™¤å…ƒæ•°æ®å¿…éœ€æ ¡éªŒ)
  - ä¿®å¤ `CreateAsync_ShouldFail_WhenColumnNullableAndNotForced` (è°ƒæ•´é”™è¯¯æ¶ˆæ¯)

#### åŠŸèƒ½ç‰¹æ€§æ€»ç»“

**æ ¸å¿ƒèƒ½åŠ›**:
1. âœ… æ”¯æŒç¼–è¾‘æœªæ‰§è¡Œé…ç½®çš„åŸºç¡€ä¿¡æ¯(å­˜å‚¨æ¨¡å¼ã€æ–‡ä»¶ç»„ã€ç›®æ ‡è¡¨ã€å¤‡æ³¨ç­‰)
2. âœ… æ‰§è¡ŒçŠ¶æ€é”å®š - `IsCommitted=true` çš„é…ç½®ç¦æ­¢ä¿®æ”¹/åˆ é™¤
3. âœ… åˆ†åŒºè¡¨ä¿æŠ¤ - å·²åˆ†åŒºè¡¨åªèƒ½é€šè¿‡åˆ†åŒºæ“ä½œè°ƒæ•´è¾¹ç•Œ,ç¦æ­¢ä¿®æ”¹é…ç½®æ–¹æ¡ˆ
4. âœ… UI äº¤äº’ä¼˜åŒ– - ç¼–è¾‘/åˆ›å»ºæ¨¡å¼å…±äº«å‘å¯¼ç»„ä»¶,æºè¡¨/åˆ†åŒºåˆ—å­—æ®µç¦ç”¨
5. âœ… æ•°æ®å®Œæ•´æ€§ - æ›´æ–°å‰éªŒè¯ã€å…ƒæ•°æ®æ£€æŸ¥ã€è¾¹ç•Œå€¼ä¿ç•™

**å®‰å…¨é˜²æŠ¤**:
- âœ… å·²æ‰§è¡Œé…ç½®ä¸å¯ç¼–è¾‘(Applicationå±‚ `UpdateAsync` æ ¡éªŒ)
- âœ… å·²æ‰§è¡Œé…ç½®ä¸å¯åˆ é™¤(Applicationå±‚ `DeleteAsync` æ ¡éªŒ)
- âœ… å·²æ‰§è¡Œé…ç½®ä¸å¯ä¿®æ”¹åˆ†åŒºå€¼(Applicationå±‚ `ReplaceValuesAsync` æ ¡éªŒ)
- âœ… å·²åˆ†åŒºè¡¨ä¸å¯ä¿®æ”¹æ–¹æ¡ˆ(é€šè¿‡ `IPartitionMetadataRepository.GetConfigurationAsync` åˆ¤æ–­)
- âœ… æºè¡¨ã€åˆ†åŒºåˆ—å­—æ®µç¦æ­¢ä¿®æ”¹(UIå±‚ `Disabled=@IsEditing`)

**ä¿®æ”¹çš„æ–‡ä»¶(11ä¸ªæ ¸å¿ƒæ–‡ä»¶)**:
1. Domain: `PartitionConfiguration.cs`
2. Infrastructure: `PartitionConfigurationEntity.cs`, `PartitionConfigurationRepository.cs`, `ArchiveDbContext.cs`, `20251010043019_AddPartitionConfigurationCommitted.cs`
3. Application: `IPartitionConfigurationAppService.cs`, `PartitionConfigurationAppService.cs`
4. API: `PartitionConfigurationsController.cs`, `PartitionConfigurationDtos.cs`
5. Web: `PartitionConfigurationApiClient.cs`, `PartitionConfigurationRequests.cs`, `PartitionConfigWizard.razor.cs`, `Partitions.razor`
6. Tests: `PartitionConfigurationAppServiceTests.cs`

**å¾…å®Œæˆå·¥ä½œ**:
- [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»: `dotnet ef database update`
- [ ] ç¼–è¯‘éªŒè¯: `dotnet build DbArchiveTool.sln`
- [ ] æ‰‹åŠ¨æµ‹è¯•: åˆ›å»ºè‰ç¨¿ â†’ ç¼–è¾‘ â†’ ä¿å­˜ â†’ éªŒè¯

---

**æœ€åæ›´æ–°**: 2025-10-10  
**å½“å‰é˜¶æ®µ**: Phase 1 å®Œæˆ **98%** (æ–°å¢é…ç½®ç¼–è¾‘åŠŸèƒ½),Phase 2 è¿›è¡Œä¸­  
**Phase 1 å‰©ä½™å·¥ä½œ**: æ•°æ®åº“è¿ç§»æ‰§è¡Œã€æ‰‹åŠ¨æµ‹è¯•éªŒè¯ã€ç”¨æˆ·æ‰‹å†Œæ›´æ–°  
**ä¸‹ä¸€é‡Œç¨‹ç¢‘**: å®Œæˆ Split/Merge/Switch æ“ä½œé¢„è§ˆä¸æ‰§è¡Œ(é¢„è®¡ 2-3 å‘¨)  
**å»ºè®®ä¸‹ä¸€æ­¥**: 
1. ç«‹å³æ‰§è¡Œæ•°æ®åº“è¿ç§»å¹¶éªŒè¯ç¼–è¾‘åŠŸèƒ½
2. ä¼˜å…ˆå®Œæˆ PartitionCommand åº”ç”¨æœåŠ¡ä¸ SQL æ¨¡æ¿æ‰§è¡Œå™¨mand é¢†åŸŸæ¨¡å‹ã€åŸºç¡€ä»“å‚¨ã€SQL æ¨¡æ¿ï¼ˆå·²åˆ›å»º Split/Merge/Switch æ¨¡æ¿ï¼‰
- **å‰ç«¯**ï¼šSplit/Merge/Switch æ¨¡æ€æ¡†å ä½ï¼ˆå¾…å®ç°ï¼‰

### ğŸ“‹ å¾…å¼€å‘ï¼ˆPhase 3-5ï¼‰
- åˆ†åŒºæ“ä½œå®Œæ•´æµç¨‹ï¼ˆé¢„è§ˆã€æ‰§è¡Œã€çŠ¶æ€æŸ¥è¯¢ï¼‰
- åå°ä»»åŠ¡æ‰§è¡Œä¸é˜Ÿåˆ—
- å®¡æ‰¹æµç¨‹ä¸å®‰å…¨è§„åˆ™
- ç”¨æˆ·æ‰‹å†Œä¸é›†æˆæµ‹è¯•

---

## ä¸€ã€åç«¯ï¼ˆDomain / Application / APIï¼‰

### 1.1 PartitionConfiguration é¢†åŸŸæ‰©å±•
   - [x] æ”¯æŒå­˜æ”¾æ¨¡å¼ã€æ–‡ä»¶ç›®å½•ã€æ–‡ä»¶å¤§å°ã€ç›®æ ‡è¡¨åã€å¤‡æ³¨ç­‰å±æ€§
   - [x] å¢åŠ å¿…è¦çš„ä¸šåŠ¡è§„åˆ™ï¼šç›®æ ‡è¡¨å‘½åæ ¡éªŒã€å•æ–‡ä»¶ç»„å‚æ•°éªŒè¯ã€åˆ†åŒºåˆ— NOT NULL è¦æ±‚ç­‰
   - [x] å®ç°åˆ†åŒºå€¼æ‰¹é‡æ›¿æ¢é€»è¾‘ä¸è¾¹ç•ŒéªŒè¯

### 1.2 PartitionCommand é¢†åŸŸæ¨¡å‹ï¼ˆPhase 2ï¼‰
   - [x] åˆ›å»º PartitionCommand èšåˆæ ¹ï¼ˆSplit/Merge/Switchï¼‰
   - [x] å®šä¹‰ PartitionSafetyRule å€¼å¯¹è±¡
   - [x] å®šä¹‰ PartitionFilegroupMapping å€¼å¯¹è±¡
   - [ ] **å®ç° PartitionCommand çŠ¶æ€æœº**ï¼ˆPendingApproval â†’ Approved â†’ Queued â†’ Executing â†’ Succeeded/Failedï¼‰
   - [ ] **æ·»åŠ é£é™©æç¤ºä¸è„šæœ¬ Hash ç”Ÿæˆé€»è¾‘**
   - [ ] **å®ç° CreateSplit/CreateMerge/CreateSwitch å·¥å‚æ–¹æ³•**

### 1.3 åº”ç”¨æœåŠ¡
   - [x] å®ç° `PartitionConfigurationAppService`ï¼ˆåˆ›å»ºé…ç½®ã€æ·»åŠ åˆ†åŒºå€¼ï¼‰
   - [x] è¾“å‡º `CreatePartitionConfigurationRequest` / `ReplacePartitionValuesRequest` DTO
   - [ ] **å®ç° `PartitionCommandAppService` å®Œæ•´åŠŸèƒ½**ï¼š
     - [ ] PreviewSplitAsync / ExecuteSplitAsync
     - [ ] PreviewMergeAsync / ExecuteMergeAsync
     - [ ] PreviewSwitchAsync / ExecuteSwitchAsync
     - [ ] GetStatusAsyncï¼ˆå‘½ä»¤çŠ¶æ€æŸ¥è¯¢ï¼‰
     - [ ] ApproveAsync / RejectAsyncï¼ˆå®¡æ‰¹æµç¨‹ï¼‰
   - [ ] **å®šä¹‰ Split/Merge/Switch è¯·æ±‚ DTO**
   - [ ] **å®šä¹‰ PartitionCommandPreviewDtoï¼ˆå«è„šæœ¬ã€é£é™©ã€Hashï¼‰**
   - [ ] **å®šä¹‰ PartitionCommandStatusDto**

### 1.4 API æ§åˆ¶å™¨
   - [x] åˆ›å»º `PartitionConfigurationsController`ï¼ˆåˆ›å»ºé…ç½®/æ›´æ–°åˆ†åŒºå€¼ï¼‰
   - [x] åˆ›å»º `PartitionCommandsController` åŸºç¡€ç»“æ„
   - [ ] **å®ç° PartitionCommandsController å®Œæ•´ç«¯ç‚¹**ï¼š
     - [ ] POST `.../split/preview` å’Œ `.../split/execute`
     - [ ] POST `.../merge/preview` å’Œ `.../merge/execute`
     - [ ] POST `.../switch/preview` å’Œ `.../switch/execute`
     - [ ] GET `/api/v1/partition-commands/{commandId}` çŠ¶æ€æŸ¥è¯¢
     - [ ] POST `/api/v1/partition-commands/{commandId}/approve|reject`
   - [ ] **è¡¥å…… XML æ³¨é‡Šä¸ ProducesResponseType å£°æ˜**

---

## äºŒã€åŸºç¡€è®¾æ–½ï¼ˆInfrastructureï¼‰

### 2.1 æ•°æ®æŒä¹…åŒ–
   - [x] æ›´æ–° EF å®ä½“ä¸ DbContext æ˜ å°„ï¼ˆPartitionConfigurationsã€PartitionValuesï¼‰
   - [x] ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬
   - [x] ä¿®å¤ SQL åˆ—åé”™è¯¯ï¼ˆ`range_type` â†’ `boundary_value_on_right`ï¼‰
   - [ ] **åˆ›å»º PartitionCommand å®ä½“æ˜ å°„ä¸è¿ç§»**
   - [ ] **åˆ›å»º PartitionCommandRepository å®ç°**

### 2.2 SQL æ¨¡æ¿ä¸æ‰§è¡Œå™¨
   - [x] åˆ›å»º SQL æ¨¡æ¿ç›®å½•ç»“æ„ï¼ˆ`SqlTemplates/Partitioning/Commands/`ï¼‰
   - [x] åˆ›å»ºåŸºç¡€æ¨¡æ¿ï¼šSplitRange.sqlã€MergeRange.sqlã€SwitchOut.sqlã€PermissionCheck.sql
   - [ ] **å®ç° ISqlTemplateProvider æ¥å£**
   - [ ] **å®ç° SqlPartitionCommandExecutor**ï¼ˆæ¨¡æ¿æ¸²æŸ“ã€äº‹åŠ¡æ‰§è¡Œã€æ—¥å¿—è®°å½•ï¼‰
   - [ ] **è¡¥å……æ¨¡æ¿**ï¼š
     - [ ] SwitchIn.sqlï¼ˆæ¢å¤åˆ†åŒºï¼‰
     - [ ] SwitchPrepareStaging.sqlï¼ˆåˆ›å»ºä¸´æ—¶è¡¨ï¼‰
     - [ ] CreateFilegroup.sqlï¼ˆæ–‡ä»¶ç»„åˆ›å»ºæ¨¡æ¿ï¼‰
   - [ ] **å®ç°æƒé™æ£€æŸ¥é€»è¾‘**ï¼ˆALTERã€CONTROLã€VIEW DEFINITIONï¼‰

### 2.3 åå°ä»»åŠ¡ä¸é˜Ÿåˆ—ï¼ˆPhase 3ï¼‰
   - [x] åˆ›å»º PartitionCommandQueue åŸºç¡€ç»“æ„
   - [x] åˆ›å»º PartitionCommandHostedService åŸºç¡€ç»“æ„
   - [ ] **å®ç° PartitionCommandQueueï¼ˆChannel<Guid> + FIFOï¼‰**
   - [ ] **å®ç° PartitionCommandHostedService å®Œæ•´é€»è¾‘**ï¼š
     - [ ] å‘½ä»¤å‡ºé˜Ÿä¸çŠ¶æ€æ›´æ–°
     - [ ] è°ƒç”¨ SqlPartitionCommandExecutor æ‰§è¡Œ
     - [ ] å¼‚å¸¸å¤„ç†ä¸é‡è¯•ç­–ç•¥
     - [ ] æ‰§è¡Œæ—¥å¿—è®°å½•
   - [ ] **æ³¨å†Œ HostedService åˆ° DI å®¹å™¨**

### 2.4 å®‰å…¨ä¸å®¡è®¡
   - [ ] **å®ç°å®‰å…¨è§„åˆ™æ£€æŸ¥å™¨**ï¼ˆåˆ†åŒºæ˜¯å¦ä¸ºç©ºã€æ¨èæ‰§è¡Œæ—¶æ®µï¼‰
   - [ ] **å®ç°å®¡è®¡æ—¥å¿—å†™å…¥**ï¼ˆæ“ä½œäººã€è„šæœ¬ Hashã€é£é™©ç¡®è®¤ï¼‰
   - [ ] **å®ç°å¤‡ä»½ç¡®è®¤éªŒè¯é€»è¾‘**

---

## ä¸‰ã€å‰ç«¯ï¼ˆBlazor Webï¼‰

### 3.1 åˆ†åŒºé…ç½®å‘å¯¼ï¼ˆPhase 1 - âœ… å·²å®Œæˆ 95%ï¼‰
   - [x] å®ç°æŠ½å±‰ + Stepsï¼ˆåŸºç¡€ä¿¡æ¯ / åˆ†åŒºå€¼ / å®Œæˆï¼‰
   - [x] å¤„ç†è¡¨é€‰æ‹©ã€åˆ—ä¿¡æ¯åŠ è½½ã€åˆ—ç»Ÿè®¡å±•ç¤ºã€ç›®æ ‡åº“ä¸‹æ‹‰
   - [x] å®ç°å¤šæ­¥éª¤æ ¡éªŒï¼ˆå¿…é€‰é¡¹ã€æ ¼å¼ã€æ–‡ä»¶å¤§å°ã€åˆ†åŒºå€¼æ’åºï¼‰
   - [x] è°ƒç”¨æ–°å»ºé…ç½® / ä¿å­˜åˆ†åŒºå€¼ API
   - [x] ä¼˜åŒ–æ—¥æœŸé€‰æ‹©å™¨ï¼ˆæŒ‰æœˆ/æŒ‰å¹´é€‰æ‹©ï¼‰
   - [x] ä¿®å¤ Context å‚æ•°å†²çªä¸ JSON åºåˆ—åŒ–é—®é¢˜
   - [x] **ä¿®å¤åˆ†åŒºåˆ—ä¸‹æ‹‰æ¡†çŠ¶æ€æ¸…ç†é—®é¢˜**ï¼ˆ2025-10-10ï¼‰
   - [x] **å®ç°æ•°æ®ç›®å½•è‡ªåŠ¨è·å–ä¸ç¼“å­˜**ï¼ˆ2025-10-10ï¼‰
   - [x] **å®ç°æ–‡ä»¶åè·Ÿéšæ–‡ä»¶ç»„åç§°è‡ªåŠ¨æ›´æ–°**ï¼ˆ2025-10-10ï¼‰
   - [x] **å®ç°åˆ—ç»Ÿè®¡æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–æ˜¾ç¤º**ï¼ˆ2025-10-10ï¼‰
   - [ ] è¡¥å……é›†æˆæµ‹è¯•ï¼ˆAPI ç«¯åˆ°ç«¯æµ‹è¯•ï¼‰
   - [ ] ç¼–å†™ç”¨æˆ·æ“ä½œæ‰‹å†Œ

### 3.2 åˆ†åŒºæ“ä½œç•Œé¢ï¼ˆPhase 2 - å¾…å¼€å‘ï¼‰
   - [x] åˆ›å»º Split/Merge/Switch æ¨¡æ€æ¡†å ä½
   - [ ] **å®ç° Splitï¼ˆæ‹†åˆ†ï¼‰å‘å¯¼**ï¼š
     - [ ] é€‰æ‹©åˆ†åŒºè¡¨ä¸æ–°å¢è¾¹ç•Œå€¼
     - [ ] æ–‡ä»¶ç»„ç­–ç•¥é€‰æ‹©
     - [ ] å‹¾é€‰å¤‡ä»½ç¡®è®¤ä¸é£é™©æç¤º
     - [ ] è°ƒç”¨é¢„è§ˆæ¥å£å±•ç¤ºè„šæœ¬
     - [ ] æäº¤æ‰§è¡Œå¹¶è·³è½¬ä»»åŠ¡æ—¥å¿—
   - [ ] **å®ç° Mergeï¼ˆåˆå¹¶ï¼‰å‘å¯¼**ï¼š
     - [ ] å±•ç¤ºå½“å‰åˆ†åŒºåˆ—è¡¨ä¸è¡Œæ•°
     - [ ] é€‰æ‹©è¦åˆå¹¶çš„åˆ†åŒºèŒƒå›´
     - [ ] é£é™©æç¤ºä¸å¤‡ä»½ç¡®è®¤
     - [ ] é¢„è§ˆè„šæœ¬å¹¶æ‰§è¡Œ
   - [ ] **å®ç° Switchï¼ˆåˆ‡æ¢ï¼‰å‘å¯¼**ï¼š
     - [ ] é€‰æ‹©æºåˆ†åŒºä¸ç›®æ ‡è¡¨
     - [ ] è‡ªåŠ¨åˆ›å»ºä¸´æ—¶è¡¨é€‰é¡¹
     - [ ] é¢„è§ˆè„šæœ¬å¹¶æ‰§è¡Œ
   - [ ] **å®ç°ä»»åŠ¡æ—¥å¿—é¡µé¢ï¼ˆTab4ï¼‰**ï¼š
     - [ ] å±•ç¤ºå‘½ä»¤åˆ—è¡¨ï¼ˆçŠ¶æ€ã€æ—¶é—´ã€æ“ä½œäººï¼‰
     - [ ] è„šæœ¬ä¸‹è½½åŠŸèƒ½
     - [ ] å®¡æ‰¹æŒ‰é’®ï¼ˆApprove/Rejectï¼‰
     - [ ] çŠ¶æ€è½®è¯¢ä¸å®æ—¶æ›´æ–°
   - [ ] **å®ç°è„šæœ¬é¢„è§ˆå¯¹è¯æ¡†**ï¼š
     - [ ] è¯­æ³•é«˜äº®æ˜¾ç¤º
     - [ ] å¤åˆ¶/ä¸‹è½½åŠŸèƒ½
     - [ ] é£é™©æç¤ºåˆ—è¡¨å±•ç¤º

### 3.3 API å®¢æˆ·ç«¯
   - [x] åˆ›å»º PartitionConfigurationApiClient
   - [x] ä¿®å¤ JSON åºåˆ—åŒ–é…ç½®
   - [ ] **æ‰©å±• PartitionCommandApiClient**ï¼š
     - [ ] PreviewSplit/ExecuteSplit æ–¹æ³•
     - [ ] PreviewMerge/ExecuteMerge æ–¹æ³•
     - [ ] PreviewSwitch/ExecuteSwitch æ–¹æ³•
     - [ ] GetCommandStatus æ–¹æ³•
     - [ ] Approve/Reject æ–¹æ³•

### 3.4 UI ä¼˜åŒ–
   - [x] ä¸ºå‘å¯¼æ–°å¢ CSSï¼ˆå¸ƒå±€ã€listã€æŒ‰é’®åŒºåŸŸï¼‰
   - [ ] **æ·»åŠ åŠ è½½çŠ¶æ€ä¸è¿›åº¦æŒ‡ç¤º**
   - [ ] **ä¼˜åŒ–é”™è¯¯æç¤ºå±•ç¤º**
   - [ ] **å®ç°è„šæœ¬é«˜äº®æ˜¾ç¤º**

---

## å››ã€æµ‹è¯•

### 4.1 å•å…ƒæµ‹è¯•
   - [x] PartitionConfiguration é¢†åŸŸé€»è¾‘æµ‹è¯•
   - [x] PartitionConfigurationAppService æ ¡éªŒé€»è¾‘æµ‹è¯•
   - [ ] **PartitionCommand é¢†åŸŸé€»è¾‘æµ‹è¯•**ï¼ˆçŠ¶æ€æœºã€å·¥å‚æ–¹æ³•ï¼‰
   - [ ] **PartitionCommandAppService æµ‹è¯•**ï¼ˆé¢„è§ˆã€æ‰§è¡Œã€å®¡æ‰¹ï¼‰
   - [ ] **SqlTemplateProvider æµ‹è¯•**ï¼ˆæ¨¡æ¿æ¸²æŸ“ã€å‚æ•°æ›¿æ¢ï¼‰

### 4.2 é›†æˆæµ‹è¯•
   - [x] åŸºç¡€ API æµ‹è¯•æ¡†æ¶æ­å»º
   - [ ] **åˆ†åŒºé…ç½® API é›†æˆæµ‹è¯•**ï¼ˆåˆ›å»ºé…ç½®ã€æ·»åŠ åˆ†åŒºå€¼æˆåŠŸ/å¤±è´¥è·¯å¾„ï¼‰
   - [ ] **åˆ†åŒºå‘½ä»¤ API é›†æˆæµ‹è¯•**ï¼ˆé¢„è§ˆ/æ‰§è¡Œ Split/Merge/Switchï¼‰
   - [ ] **åå°ä»»åŠ¡é›†æˆæµ‹è¯•**ï¼ˆQueue + HostedService + Executorï¼‰
   - [ ] **æƒé™æ£€æŸ¥é›†æˆæµ‹è¯•**

### 4.3 å‰ç«¯æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
   - [ ] bUnit ç»„ä»¶æµ‹è¯•ï¼ˆåˆ†åŒºå‘å¯¼å…³é”®äº¤äº’ï¼‰
   - [ ] Playwright E2E æµ‹è¯•ï¼ˆå®Œæ•´åˆ†åŒºé…ç½®æµç¨‹ï¼‰

---

## äº”ã€æ–‡æ¡£ä¸äº¤ä»˜

### 5.1 æŠ€æœ¯æ–‡æ¡£
   - [x] åœ¨ã€Šåˆ†åŒºç®¡ç†åŠŸèƒ½è®¾è®¡ã€‹è¡¥å……å‘å¯¼å®é™…å®ç°ç»†èŠ‚
   - [x] æ›´æ–°å¼€å‘æ¸…å•ï¼ˆæœ¬æ–‡æ¡£ï¼‰
   - [ ] **ç¼–å†™ SQL æ¨¡æ¿ä½¿ç”¨è¯´æ˜**ï¼ˆå‚æ•°ã€å‘½åè§„åˆ™ã€é£é™©æç¤ºï¼‰
   - [ ] **ç¼–å†™åå°ä»»åŠ¡é…ç½®è¯´æ˜**ï¼ˆé‡è¯•ç­–ç•¥ã€å¹¶å‘æ§åˆ¶ï¼‰
   - [ ] **ç¼–å†™æƒé™é…ç½®æŒ‡å—**ï¼ˆæ‰€éœ€æƒé™åˆ—è¡¨ã€æ£€æŸ¥æ–¹æ³•ï¼‰

### 5.2 ç”¨æˆ·æ–‡æ¡£
   - [ ] **ç”Ÿæˆåˆ†åŒºé…ç½®å‘å¯¼ä½¿ç”¨æ‰‹å†Œ**ï¼ˆæˆªå›¾ + æ­¥éª¤è¯´æ˜ï¼‰
   - [ ] **ç”Ÿæˆåˆ†åŒºæ“ä½œæŒ‡å—**ï¼ˆSplit/Merge/Switch æ“ä½œæµç¨‹ï¼‰
   - [ ] **ç”Ÿæˆå®‰å…¨æœ€ä½³å®è·µæ–‡æ¡£**ï¼ˆå¤‡ä»½ã€é£é™©æç¤ºã€å®¡æ‰¹æµç¨‹ï¼‰

### 5.3 é¡¹ç›®ç®¡ç†
   - [ ] åœ¨ README çš„"åŠŸèƒ½è§„åˆ’" / "å½“å‰è¿›åº¦"æ›´æ–°åˆ†åŒºé…ç½®é‡Œç¨‹ç¢‘
   - [ ] åˆ›å»º CHANGELOG è®°å½•åŠŸèƒ½å˜æ›´
   - [ ] æ›´æ–°éƒ¨ç½²æ¸…å•ï¼ˆè¿ç§»è„šæœ¬ã€é…ç½®é¡¹ã€æƒé™è¦æ±‚ï¼‰

---

## å…­ã€å®æ–½ä¼˜å…ˆçº§ï¼ˆSprint è§„åˆ’ï¼‰

### ğŸ”¥ Sprint 1ï¼ˆå½“å‰ - âœ… å·²å®Œæˆ 98%ï¼‰
**ç›®æ ‡**ï¼šåˆ†åŒºé…ç½®å‘å¯¼åŸºç¡€åŠŸèƒ½ä¸Šçº¿
- [x] åç«¯ï¼šé¢†åŸŸæ¨¡å‹ã€åº”ç”¨æœåŠ¡ã€API
- [x] å‰ç«¯ï¼šé…ç½®å‘å¯¼ UI
- [x] ä¿®å¤ï¼šSQL é”™è¯¯ã€åºåˆ—åŒ–é—®é¢˜
- [x] **UI å¢å¼º**ï¼šä¸‹æ‹‰æ¡†çŠ¶æ€æ¸…ç†ã€æ•°æ®ç›®å½•ç¼“å­˜ã€æ–‡ä»¶åè‡ªåŠ¨æ›´æ–°ã€æ—¥æœŸæ ¼å¼åŒ–ï¼ˆ2025-10-10ï¼‰
- [x] **é…ç½®ç¼–è¾‘åŠŸèƒ½**ï¼šè‰ç¨¿ç¼–è¾‘ã€æ‰§è¡ŒçŠ¶æ€é”å®šã€å·²åˆ†åŒºè¡¨ä¿æŠ¤ï¼ˆ2025-10-10ï¼‰
- [ ] **æ•°æ®åº“è¿ç§»æ‰§è¡Œ**ï¼šAddPartitionConfigurationCommitted
- [ ] **æ‰‹åŠ¨æµ‹è¯•**ï¼šéªŒè¯ç¼–è¾‘åŠŸèƒ½å®Œæ•´æµç¨‹
- [ ] é›†æˆæµ‹è¯•ï¼šAPI æµ‹è¯•è¡¥å……
- [ ] ç”¨æˆ·æ–‡æ¡£ï¼šæ“ä½œæ‰‹å†Œç¼–å†™ï¼ˆå«ç¼–è¾‘æµç¨‹ï¼‰

### ğŸ¯ Sprint 2ï¼ˆä¸‹ä¸€æ­¥ - Phase 2ï¼‰
**ç›®æ ‡**ï¼šåˆ†åŒºæ“ä½œå‘½ä»¤é¢„è§ˆä¸æ‰§è¡Œ
- [ ] å®ç° PartitionCommand å®Œæ•´é¢†åŸŸæ¨¡å‹ä¸çŠ¶æ€æœº
- [ ] å®ç° PartitionCommandAppService é¢„è§ˆ/æ‰§è¡Œé€»è¾‘
- [ ] å®ç° SqlTemplateProvider ä¸ SqlPartitionCommandExecutor
- [ ] å‰ç«¯ï¼šSplit/Merge/Switch å‘å¯¼ UI
- [ ] å•å…ƒæµ‹è¯•ï¼šå‘½ä»¤é€»è¾‘ä¸æ¨¡æ¿æ¸²æŸ“

### ğŸš€ Sprint 3ï¼ˆPhase 3ï¼‰
**ç›®æ ‡**ï¼šåå°ä»»åŠ¡ä¸å¼‚æ­¥æ‰§è¡Œ
- [ ] å®ç° PartitionCommandQueue ä¸ HostedService
- [ ] å®ç°ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢ä¸æ—¥å¿—è®°å½•
- [ ] å‰ç«¯ï¼šä»»åŠ¡æ—¥å¿—é¡µé¢ä¸çŠ¶æ€è½®è¯¢
- [ ] é›†æˆæµ‹è¯•ï¼šåå°ä»»åŠ¡æµç¨‹

### ğŸ”’ Sprint 4ï¼ˆPhase 4ï¼‰
**ç›®æ ‡**ï¼šå®¡æ‰¹æµç¨‹ä¸å®‰å…¨å¢å¼º
- [ ] å®ç°å®¡æ‰¹ API ä¸æƒé™æ£€æŸ¥
- [ ] å®ç°å®‰å…¨è§„åˆ™ä¸é£é™©æç¤º
- [ ] å‰ç«¯ï¼šå®¡æ‰¹ç•Œé¢ä¸é£é™©å±•ç¤º
- [ ] ç”¨æˆ·æ–‡æ¡£ï¼šæ“ä½œæ‰‹å†Œä¸æœ€ä½³å®è·µ

### ğŸ“š Sprint 5ï¼ˆPhase 5ï¼‰
**ç›®æ ‡**ï¼šæ–‡æ¡£å®Œå–„ä¸å‘å¸ƒå‡†å¤‡
- [ ] å®Œå–„æŠ€æœ¯æ–‡æ¡£ä¸ç”¨æˆ·æ‰‹å†Œ
- [ ] è¡¥å……é›†æˆæµ‹è¯•ä¸ E2E æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–ä¸ä»£ç å®¡æŸ¥
- [ ] éƒ¨ç½²æ¸…å•ä¸å‘å¸ƒè¯´æ˜

---

## ä¸ƒã€é£é™©ä¸ä¾èµ–

### é£é™©é¡¹
1. **SQL Server æƒé™ä¸è¶³**ï¼šæ‰§è¡Œè´¦æˆ·å¯èƒ½ç¼ºå°‘å¿…è¦æƒé™ï¼ˆALTERã€CONTROL ç­‰ï¼‰
2. **ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œé£é™©**ï¼šåˆ†åŒºæ“ä½œå¯èƒ½å½±å“ä¸šåŠ¡ï¼Œéœ€è¦å®¡æ‰¹ä¸å¤‡ä»½ç¡®è®¤
3. **åå°ä»»åŠ¡å¤±è´¥å¤„ç†**ï¼šéœ€è¦å®Œå–„é‡è¯•ç­–ç•¥ä¸å¼‚å¸¸é€šçŸ¥

### å¤–éƒ¨ä¾èµ–
- SQL Server 2016+ æ”¯æŒåˆ†åŒºå‡½æ•°ä¸æ–¹æ¡ˆ
- .NET 8 è¿è¡Œç¯å¢ƒ
- AntDesign Blazor ç»„ä»¶åº“

### å†…éƒ¨ä¾èµ–
- ArchiveDbContext æ•°æ®åº“è¿ç§»
- AdminSessionState ç”¨æˆ·èº«ä»½è¯†åˆ«
- IDbConnectionFactory æ•°æ®æºè¿æ¥ç®¡ç†

---

## å…«ã€è¿‘æœŸä¿®å¤æ€»ç»“

### 2025-10-09 ä¿®å¤
1. **SQL åˆ—åé”™è¯¯**ï¼š`pf.range_type` â†’ `pf.boundary_value_on_right`ï¼ˆSqlServerPartitionMetadataRepository.csï¼‰
2. **JSON æšä¸¾åºåˆ—åŒ–ä¸ä¸€è‡´**ï¼šç»Ÿä¸€å‰åç«¯ä½¿ç”¨ `JsonStringEnumConverter()`ï¼ˆPascalCaseï¼‰
3. **Context å‚æ•°å†²çª**ï¼šç§»é™¤ ActionColumn çš„æ˜¾å¼ `Context="context"` å£°æ˜
4. **æ—¥æœŸé€‰æ‹©å™¨ä¼˜åŒ–**ï¼šç®€åŒ–ä¸ºæŒ‰æœˆ/æŒ‰å¹´é€‰æ‹©ï¼Œç§»é™¤æ—¶é—´é€‰æ‹©

### 2025-10-10 æ–°å¢åŠŸèƒ½ âœ¨
**åˆ†åŒºé…ç½®å‘å¯¼ UI å¢å¼ºï¼ˆPartitions.razorï¼‰**

1. **âœ… ä¿®å¤åˆ†åŒºåˆ—ä¸‹æ‹‰æ¡†çŠ¶æ€é—®é¢˜**
   - é—®é¢˜ï¼šåˆ‡æ¢æºè¡¨æ—¶ï¼Œåˆ†åŒºåˆ—ä¸‹æ‹‰æ¡†æ˜¾ç¤ºä¸Šä¸€ä¸ªè¡¨çš„åˆ—å
   - è§£å†³ï¼šåœ¨ `ApplyTableSelectionAsync` ä¸­æ¸…ç©º `PartitionColumn`ã€`Columns`ã€`Boundaries`
   - ä½¿ç”¨ `@bind-Value` + `OnSelectedItemChanged` æ›¿ä»£ `Value/ValueChanged` é¿å…åŒé‡ç»‘å®š

2. **âœ… æ•°æ®ç›®å½•è‡ªåŠ¨è·å–ä¸ç¼“å­˜**
   - é—®é¢˜ï¼šåˆ‡æ¢åˆ°"å•ç‹¬æ–‡ä»¶ç»„+å•ä¸€æ•°æ®æ–‡ä»¶"æ¨¡å¼æ—¶ï¼Œæ•°æ®ç›®å½•å­—æ®µä¸ºç©º
   - è§£å†³ï¼šå‘å¯¼åˆå§‹åŒ–æ—¶è·å–æœåŠ¡å™¨é»˜è®¤ç›®å½•å¹¶ç¼“å­˜åˆ° `CachedDefaultFileDirectory`
   - åœ¨ `ApplyStorageModeDefaults` ä¸­ä»ç¼“å­˜æ¢å¤

3. **âœ… æ–‡ä»¶åè·Ÿéšæ–‡ä»¶ç»„åç§°è‡ªåŠ¨æ›´æ–°**
   - é—®é¢˜ï¼šç”¨æˆ·æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶ç»„åç§°åï¼Œæ–‡ä»¶åä¸è‡ªåŠ¨æ›´æ–°
   - è§£å†³ï¼šä¸ºæ–‡ä»¶ç»„åç§°è¾“å…¥æ¡†æ·»åŠ  `OnBlur="HandleFilegroupNameChanged"` äº‹ä»¶
   - æå– `RegenerateDataFileName()` æ–¹æ³•ç”Ÿæˆæ ¼å¼åŒ–æ–‡ä»¶å
   - **ä¼˜åŒ–**ï¼šåˆ‡æ¢æºè¡¨æ—¶ä¹Ÿè‡ªåŠ¨è§¦å‘æ–‡ä»¶åæ›´æ–°ï¼ˆé€šè¿‡ `ApplyStorageModeDefaults` æ£€æµ‹ `filegroupChanged` æ ‡è®°ï¼‰

4. **âœ… åˆ—ç»Ÿè®¡æ—¥æœŸæ—¶é—´æ ¼å¼åŒ–**
   - é—®é¢˜ï¼šdatetime åˆ—çš„ç»Ÿè®¡å€¼ï¼ˆæœ€å°å€¼/æœ€å¤§å€¼ï¼‰æ˜¾ç¤ºåŸå§‹ SQL Server æ ¼å¼
   - è§£å†³ï¼šåˆ›å»º `FormatColumnStatValue(string? value)` æ–¹æ³•
   - `Date` ç±»å‹æ ¼å¼åŒ–ä¸º `yyyy-MM-dd`
   - `DateTime/DateTime2` ç±»å‹æ ¼å¼åŒ–ä¸º `yyyy-MM-dd HH:mm:ss`

**åç«¯ API æ‰©å±•**

5. **âœ… æ–°å¢é€šç”¨è¡¨/åˆ—æŸ¥è¯¢ç«¯ç‚¹**
   - `GET /api/v1/data-sources/{id}/tables` - æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·è¡¨ï¼ˆéåˆ†åŒºè¡¨ä¹Ÿå¯é€‰æ‹©ï¼‰
   - `GET /api/v1/data-sources/{id}/tables/{schema}/{table}/columns` - é€šç”¨åˆ—æŸ¥è¯¢
   - `GET /api/v1/data-sources/{id}/tables/{schema}/{table}/columns/{column}/statistics` - é€šç”¨åˆ—ç»Ÿè®¡
   - æ–°å¢ `SqlPartitionQueryService.GetDatabaseTablesAsync` æ–¹æ³•
   - æ–°å¢ `DatabaseTableDto` ç±»

### ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆ2025-10-10ï¼‰
1. `PartitionInfoController.cs` - æ·»åŠ  3 ä¸ªæ–°çš„é€šç”¨ API ç«¯ç‚¹ï¼ˆ`~/api/v1/data-sources/{id}/tables`ï¼‰
2. `SqlPartitionQueryService.cs` - æ·»åŠ  `GetDatabaseTablesAsync` æ–¹æ³•å’Œ `DatabaseTableDto`
3. `PartitionInfoApiClient.cs` - æ·»åŠ  `GetDatabaseTablesAsync` æ–¹æ³•ï¼Œä¿®æ­£ API è·¯å¾„
4. `Partitions.razor` - ä¸»è¦ä¼˜åŒ–ï¼š
   - ä¿®æ”¹äº‹ä»¶å¤„ç†å™¨ä¸º `HandleSourceTableChanged/HandlePartitionColumnChanged`
   - æ·»åŠ  `CachedDefaultFileDirectory` ç¼“å­˜å­—æ®µ
   - æ·»åŠ  `HandleFilegroupNameChanged` å’Œ `RegenerateDataFileName` æ–¹æ³•
   - æ·»åŠ  `FormatColumnStatValue` æ–¹æ³•
   - ä¼˜åŒ– `ApplyStorageModeDefaults` é€»è¾‘ï¼ˆæ£€æµ‹æ–‡ä»¶ç»„åç§°å˜åŒ–ï¼‰

---

**æœ€åæ›´æ–°**ï¼š2025-10-10  
**å½“å‰é˜¶æ®µ**ï¼šPhase 1 å®Œæˆ 95%ï¼ŒPhase 2 è¿›è¡Œä¸­  
**Phase 1 å‰©ä½™å·¥ä½œ**ï¼šé›†æˆæµ‹è¯•è¡¥å……ã€ç”¨æˆ·æ‰‹å†Œç¼–å†™  
**ä¸‹ä¸€é‡Œç¨‹ç¢‘**ï¼šå®Œæˆ Split/Merge/Switch æ“ä½œé¢„è§ˆä¸æ‰§è¡Œï¼ˆé¢„è®¡ 2-3 å‘¨ï¼‰  
**å»ºè®®ä¸‹ä¸€æ­¥**ï¼šä¼˜å…ˆå®Œæˆ PartitionCommand åº”ç”¨æœåŠ¡ä¸ SQL æ¨¡æ¿æ‰§è¡Œå™¨
