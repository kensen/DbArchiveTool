# æ–°æ•°æ®åº“å½’æ¡£å·¥å…· - æ€»ä½“æ¶æ„è®¾è®¡

> **ç‰ˆæœ¬**: 1.0  
> **æ—¥æœŸ**: 2025å¹´9æœˆ29æ—¥  
> **è®¾è®¡åŸåˆ™**: ç²¾ç®€æ¶æ„ã€å¿«é€Ÿè¿­ä»£ã€æ¨¡å—åŒ–å¼€å‘  

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### è®¾è®¡ç†å¿µ
- **ç²¾ç®€è‡³ä¸Š**: é¿å…è¿‡åº¦è®¾è®¡ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½å®ç°
- **æ¨¡å—åŒ–**: æŒ‰åŠŸèƒ½åŸŸåˆ’åˆ†ï¼Œæ”¯æŒç‹¬ç«‹å¼€å‘å’Œéƒ¨ç½²
- **å¿«é€Ÿè¿­ä»£**: æ”¯æŒåŠŸèƒ½æ¨¡å—çš„å¿«é€Ÿå¼€å‘å’Œä¸Šçº¿
- **æŠ€æœ¯å…ˆè¿›**: é‡‡ç”¨ .NET 8 + Blazor Server ç°ä»£æŠ€æœ¯æ ˆ
- **åŒæ•°æ®è®¿é—®**: EF Core ä»“å‚¨ + Dapper åŸç”ŸSQLï¼Œå„å¸å…¶èŒ

### æŠ€æœ¯é€‰å‹

#### åç«¯æŠ€æœ¯æ ˆ
- **.NET 8**: æœ€æ–°é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæ€§èƒ½ä¼˜è¶Š
- **ASP.NET Core 8**: Web API å’Œ Blazor Server æ”¯æŒ
- **Entity Framework Core 8**: é…ç½®ç®¡ç†å’Œä¸šåŠ¡æ•°æ®æŒä¹…åŒ–
- **Dapper**: é«˜æ€§èƒ½åŸç”Ÿ SQL æ‰§è¡Œï¼Œç”¨äºå½’æ¡£è„šæœ¬
- **Microsoft Extensions**: ä¾èµ–æ³¨å…¥ã€é…ç½®ã€æ—¥å¿—ç­‰åŸºç¡€è®¾æ–½

#### å‰ç«¯æŠ€æœ¯æ ˆ
- **Blazor Server**: C# å…¨æ ˆå¼€å‘ï¼Œå‡å°‘æŠ€æœ¯æ ˆå¤æ‚åº¦
- **Ant Design Blazor**: ä¼ä¸šçº§ UI ç»„ä»¶åº“
- **SignalR**: å®æ—¶é€šä¿¡ï¼Œç”¨äºä»»åŠ¡è¿›åº¦æ¨é€
- **Bootstrap 5**: å“åº”å¼å¸ƒå±€æ”¯æŒ

#### æ•°æ®å­˜å‚¨
- **SQL Server**: å·¥å…·é…ç½®å’Œå…ƒæ•°æ®å­˜å‚¨
- **Redis** (å¯é€‰): ç¼“å­˜å’Œä¼šè¯å­˜å‚¨
- **æ–‡ä»¶ç³»ç»Ÿ**: æ—¥å¿—æ–‡ä»¶å’Œä¸´æ—¶æ•°æ®å­˜å‚¨

---

## ğŸ”§ ç³»ç»Ÿæ¶æ„

### åˆ†å±‚æ¶æ„

```mermaid
graph TD
    A[Presentation Layer<br/>Blazor Server + WebAPI] --> B[Application Layer<br/>Services + Commands]
    B --> C[Domain Layer<br/>Entities + Business Logic]
    B --> D[Infrastructure Layer<br/>EF Core + Dapper + External Services]
    
    subgraph "Data Access"
        E[Repository Pattern<br/>EF Core]
        F[SQL Executor<br/>Dapper]
    end
    
    D --> E
    D --> F
    
    subgraph "External Systems"
        G[SQL Server<br/>Target Databases]
        H[File System<br/>Logs & Temp Files]
    end
    
    F --> G
    D --> H
```

#### 1. è¡¨ç¤ºå±‚ (Presentation Layer)
**èŒè´£**: ç”¨æˆ·ç•Œé¢å’ŒAPIæ¥å£
**æŠ€æœ¯**: Blazor Server + ASP.NET Core WebAPI

**ç»„ä»¶æ„æˆ**:
- **Blazor Pages**: ç”¨æˆ·ç•Œé¢é¡µé¢
- **Blazor Components**: å¯å¤ç”¨UIç»„ä»¶
- **Web API Controllers**: RESTful APIæ¥å£
- **SignalR Hubs**: å®æ—¶é€šä¿¡ä¸­å¿ƒ
- **Middleware**: è®¤è¯ã€å¼‚å¸¸å¤„ç†ã€æ—¥å¿—ä¸­é—´ä»¶

#### 2. åº”ç”¨å±‚ (Application Layer)
**èŒè´£**: ä¸šåŠ¡æµç¨‹ç¼–æ’å’ŒæœåŠ¡åè°ƒ
**æŠ€æœ¯**: .NET 8 Services

**ç»„ä»¶æ„æˆ**:
- **Application Services**: åº”ç”¨æœåŠ¡ï¼Œä¸šåŠ¡æµç¨‹ç¼–æ’
- **Command Handlers**: å‘½ä»¤å¤„ç†å™¨ï¼Œæ‰§è¡Œå…·ä½“ä¸šåŠ¡æ“ä½œ
- **Query Services**: æŸ¥è¯¢æœåŠ¡ï¼Œæ•°æ®æ£€ç´¢å’Œå±•ç¤º
- **Background Services**: åå°ä»»åŠ¡æœåŠ¡ï¼Œå®šæ—¶è°ƒåº¦
- **Validators**: æ•°æ®éªŒè¯å™¨
- **Mappers**: å¯¹è±¡æ˜ å°„å™¨ (AutoMapper)

#### 3. é¢†åŸŸå±‚ (Domain Layer)
**èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸæ¨¡å‹
**æŠ€æœ¯**: .NET 8 Class Libraries

**ç»„ä»¶æ„æˆ**:
- **Entities**: é¢†åŸŸå®ä½“å¯¹è±¡
- **Value Objects**: å€¼å¯¹è±¡
- **Domain Services**: é¢†åŸŸæœåŠ¡
- **Aggregates**: èšåˆæ ¹
- **Business Rules**: ä¸šåŠ¡è§„åˆ™éªŒè¯
- **Domain Events**: é¢†åŸŸäº‹ä»¶ (å¯é€‰)

#### 4. åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
**èŒè´£**: æŠ€æœ¯å®ç°å’Œå¤–éƒ¨ç³»ç»Ÿé›†æˆ
**æŠ€æœ¯**: EF Core + Dapper + ç¬¬ä¸‰æ–¹åº“

**ç»„ä»¶æ„æˆ**:
- **EF Core Repositories**: ä»“å‚¨æ¨¡å¼å®ç°
- **Dapper SQL Executors**: åŸç”ŸSQLæ‰§è¡Œå™¨
- **Database Context**: æ•°æ®åº“ä¸Šä¸‹æ–‡
- **External Services**: å¤–éƒ¨æœåŠ¡é›†æˆ
- **File Services**: æ–‡ä»¶æ“ä½œæœåŠ¡
- **Caching Services**: ç¼“å­˜æœåŠ¡

---

## ğŸ“ é¡¹ç›®ç»“æ„

### è§£å†³æ–¹æ¡ˆç»“æ„
```
DbArchiveTool.sln
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ DbArchiveTool.Web/              # Blazor Server ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ DbArchiveTool.Api/              # Web API (å¯é€‰ç‹¬ç«‹éƒ¨ç½²)
â”‚   â”œâ”€â”€ DbArchiveTool.Application/      # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ DbArchiveTool.Domain/           # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ DbArchiveTool.Infrastructure/   # åŸºç¡€è®¾æ–½å±‚
â”‚   â””â”€â”€ DbArchiveTool.Shared/           # å…±äº«ç±»åº“
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ DbArchiveTool.UnitTests/        # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ DbArchiveTool.IntegrationTests/ # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ DbArchiveTool.E2ETests/         # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ docs/                               # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/                            # éƒ¨ç½²è„šæœ¬
â””â”€â”€ docker/                             # Dockeré…ç½®
```

### é¡¹ç›®è¯¦ç»†ç»“æ„

#### 1. DbArchiveTool.Web (Blazor Server)
**èŒè´£**: æä¾›åŸºäº AntDesign Blazor çš„ç”¨æˆ·ç•Œé¢,é€šè¿‡ API å®¢æˆ·ç«¯è°ƒç”¨åç«¯æœåŠ¡ã€‚

```
DbArchiveTool.Web/
â”œâ”€â”€ Pages/                           # Razor é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Admin/                       # ç®¡ç†å‘˜é¡µé¢
â”‚   â”‚   â”œâ”€â”€ Login.razor              # ç™»å½•é¡µé¢
â”‚   â”‚   â””â”€â”€ Settings.razor           # ç³»ç»Ÿè®¾ç½®
â”‚   â”œâ”€â”€ PartitionExecutions/         # åˆ†åŒºæ‰§è¡Œç›‘æ§
â”‚   â”‚   â”œâ”€â”€ ExecutionWizard.razor    # æ‰§è¡Œå‘å¯¼é¡µé¢
â”‚   â”‚   â”œâ”€â”€ ExecutionWizard.razor.cs # æ‰§è¡Œå‘å¯¼ä»£ç åç½®
â”‚   â”‚   â””â”€â”€ Monitor.razor            # æ‰§è¡Œç›‘æ§é¡µé¢
â”‚   â”œâ”€â”€ Partitions/                  # åˆ†åŒºç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ Index.razor                  # é¦–é¡µ
â”‚   â”œâ”€â”€ Partitions.razor             # åˆ†åŒºåˆ—è¡¨é¡µ
â”‚   â”œâ”€â”€ AuditLogs.razor              # å®¡è®¡æ—¥å¿—é¡µé¢
â”‚   â”œâ”€â”€ PartitionTableInfo.cs        # åˆ†åŒºè¡¨ä¿¡æ¯æ¨¡å‹
â”‚   â””â”€â”€ _Host.cshtml                 # Blazor Server å®¿ä¸»é¡µ
â”œâ”€â”€ Components/                      # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ PartitionConfigWizard.razor  # åˆ†åŒºé…ç½®å‘å¯¼ç»„ä»¶
â”‚   â””â”€â”€ PartitionConfigWizard.razor.cs # é…ç½®å‘å¯¼ä»£ç åç½®
â”œâ”€â”€ Services/                        # API å®¢æˆ·ç«¯æœåŠ¡
â”‚   â”œâ”€â”€ AdminUserApiClient.cs        # ç®¡ç†å‘˜ç”¨æˆ· API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ ArchiveDataSourceApiClient.cs # å½’æ¡£æ•°æ®æº API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ PartitionConfigurationApiClient.cs # åˆ†åŒºé…ç½® API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ PartitionExecutionApiClient.cs # åˆ†åŒºæ‰§è¡Œ API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ PartitionInfoApiClient.cs    # åˆ†åŒºä¿¡æ¯ API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ PartitionManagementApiClient.cs # åˆ†åŒºç®¡ç† API å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ PartitionCommandRequests.cs  # åˆ†åŒºå‘½ä»¤è¯·æ±‚æ¨¡å‹
â”‚   â””â”€â”€ PartitionConfigurationRequests.cs # åˆ†åŒºé…ç½®è¯·æ±‚æ¨¡å‹
â”œâ”€â”€ Core/                            # æ ¸å¿ƒçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ AdminAuthStorageService.cs   # ç®¡ç†å‘˜è®¤è¯å­˜å‚¨æœåŠ¡
â”‚   â”œâ”€â”€ AdminSessionState.cs         # ç®¡ç†å‘˜ä¼šè¯çŠ¶æ€
â”‚   â””â”€â”€ PartitionPageState.cs        # åˆ†åŒºé¡µé¢çŠ¶æ€
â”œâ”€â”€ Shared/                          # å…±äº«å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ Data/                            # ç¤ºä¾‹æ•°æ®æœåŠ¡
â”‚   â”œâ”€â”€ WeatherForecast.cs           # å¤©æ°”é¢„æŠ¥æ¨¡å‹(ç¤ºä¾‹)
â”‚   â””â”€â”€ WeatherForecastService.cs    # å¤©æ°”é¢„æŠ¥æœåŠ¡(ç¤ºä¾‹)
â”œâ”€â”€ wwwroot/                         # é™æ€èµ„æº(CSS/JS/å›¾ç‰‡)
â”œâ”€â”€ App.razor                        # åº”ç”¨æ ¹ç»„ä»¶
â”œâ”€â”€ _Imports.razor                   # å…¨å±€ Razor å¼•ç”¨
â”œâ”€â”€ Program.cs                       # åº”ç”¨å…¥å£ç‚¹
â””â”€â”€ appsettings.json                 # åº”ç”¨é…ç½®æ–‡ä»¶
```

#### 2. DbArchiveTool.Api (Web API)
**èŒè´£**: æä¾› RESTful API ç«¯ç‚¹,å°†è¯·æ±‚å§”æ‰˜ç»™ Application å±‚æœåŠ¡ã€‚

```
DbArchiveTool.Api/
â”œâ”€â”€ Controllers/                     # API æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ AdminUsersController.cs      # ç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ ArchiveTasksController.cs    # å½’æ¡£ä»»åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ DataSourcesController.cs     # æ•°æ®æºç®¡ç†
â”‚   â”œâ”€â”€ PartitionArchiveController.cs # åˆ†åŒºå½’æ¡£æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ PartitionCommandsController.cs # åˆ†åŒºå‘½ä»¤æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ PartitionConfigurationsController.cs # åˆ†åŒºé…ç½®æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ PartitionExecutionsController.cs # åˆ†åŒºæ‰§è¡Œæ§åˆ¶å™¨
â”‚   â””â”€â”€ PartitionManagementController.cs # åˆ†åŒºç®¡ç†æ§åˆ¶å™¨
â”œâ”€â”€ Models/                          # API è§†å›¾æ¨¡å‹
â”œâ”€â”€ Program.cs                       # åº”ç”¨å…¥å£å’Œä¸­é—´ä»¶é…ç½®
â”œâ”€â”€ appsettings.json                 # é…ç½®æ–‡ä»¶(å«è¿æ¥å­—ç¬¦ä¸²)
â”œâ”€â”€ appsettings.Development.json     # å¼€å‘ç¯å¢ƒé…ç½®
â””â”€â”€ DbArchiveTool.Api.http           # HTTP æµ‹è¯•æ–‡ä»¶
```

#### 3. DbArchiveTool.Application (åº”ç”¨å±‚)
**èŒè´£**: å®ç°ä¸šåŠ¡ç”¨ä¾‹ç¼–æ’,åè°ƒé¢†åŸŸå±‚å’ŒåŸºç¡€è®¾æ–½å±‚ã€‚

```
DbArchiveTool.Application/
â”œâ”€â”€ ArchiveTasks/                    # å½’æ¡£ä»»åŠ¡åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ IArchiveTaskCommandService.cs # å½’æ¡£ä»»åŠ¡å‘½ä»¤æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ ArchiveTaskCommandService.cs # å‘½ä»¤æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IArchiveTaskQueryService.cs  # å½’æ¡£ä»»åŠ¡æŸ¥è¯¢æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ ArchiveTaskQueryService.cs   # æŸ¥è¯¢æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ CreateArchiveTaskRequest.cs  # åˆ›å»ºå½’æ¡£ä»»åŠ¡è¯·æ±‚ DTO
â”‚   â””â”€â”€ ArchiveTaskDto.cs            # å½’æ¡£ä»»åŠ¡æ•°æ®ä¼ è¾“å¯¹è±¡
â”œâ”€â”€ DataSources/                     # æ•°æ®æºç®¡ç†æœåŠ¡
â”‚   â””â”€â”€ (æ•°æ®æºç›¸å…³æœåŠ¡å’Œ DTOs)
â”œâ”€â”€ Partitions/                      # åˆ†åŒºç®¡ç†åº”ç”¨æœåŠ¡
â”‚   â”œâ”€â”€ IPartitionConfigurationAppService.cs # åˆ†åŒºé…ç½®æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ PartitionConfigurationAppService.cs # åˆ†åŒºé…ç½®æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IPartitionCommandAppService.cs # åˆ†åŒºå‘½ä»¤æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ PartitionCommandAppService.cs # åˆ†åŒºå‘½ä»¤æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IPartitionExecutionAppService.cs # åˆ†åŒºæ‰§è¡ŒæœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ PartitionExecutionAppService.cs # åˆ†åŒºæ‰§è¡ŒæœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IPartitionArchiveAppService.cs # åˆ†åŒºå½’æ¡£æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ PartitionArchiveAppService.cs # åˆ†åŒºå½’æ¡£æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IPartitionManagementAppService.cs # åˆ†åŒºç®¡ç†æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ PartitionManagementAppService.cs # åˆ†åŒºç®¡ç†æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ IPartitionExecutionDispatcher.cs # åˆ†åŒºæ‰§è¡Œè°ƒåº¦å™¨æ¥å£
â”‚   â”œâ”€â”€ PartitionValueParser.cs      # åˆ†åŒºå€¼è§£æå™¨
â”‚   â””â”€â”€ Dtos/                        # åˆ†åŒº DTOs
â”‚       â”œâ”€â”€ PartitionConfigurationDto.cs # åˆ†åŒºé…ç½® DTO
â”‚       â”œâ”€â”€ CreatePartitionConfigRequest.cs # åˆ›å»ºåˆ†åŒºé…ç½®è¯·æ±‚
â”‚       â”œâ”€â”€ UpdatePartitionConfigRequest.cs # æ›´æ–°åˆ†åŒºé…ç½®è¯·æ±‚
â”‚       â”œâ”€â”€ PartitionExecutionRequest.cs # åˆ†åŒºæ‰§è¡Œè¯·æ±‚
â”‚       â””â”€â”€ (å…¶ä»–è¯·æ±‚/å“åº”æ¨¡å‹)
â”œâ”€â”€ AdminUsers/                      # ç®¡ç†å‘˜ç”¨æˆ·æœåŠ¡
â”œâ”€â”€ Abstractions/                    # åº”ç”¨å±‚æŠ½è±¡
â”œâ”€â”€ DependencyInjection.cs           # ä¾èµ–æ³¨å…¥æ‰©å±•
â””â”€â”€ AssemblyInfo.cs                  # ç¨‹åºé›†ä¿¡æ¯
```

#### 4. DbArchiveTool.Domain (é¢†åŸŸå±‚)
**èŒè´£**: å°è£…æ ¸å¿ƒä¸šåŠ¡é€»è¾‘,å®šä¹‰èšåˆæ ¹ã€å®ä½“ã€å€¼å¯¹è±¡å’Œä»“å‚¨æ¥å£ã€‚

```
DbArchiveTool.Domain/
â”œâ”€â”€ ArchiveTasks/                    # å½’æ¡£ä»»åŠ¡èšåˆ
â”‚   â”œâ”€â”€ ArchiveTask.cs               # å½’æ¡£ä»»åŠ¡èšåˆæ ¹
â”‚   â”œâ”€â”€ ArchiveTaskStatus.cs         # ä»»åŠ¡çŠ¶æ€æšä¸¾
â”‚   â”œâ”€â”€ ArchiveTaskFailedEvent.cs    # ä»»åŠ¡å¤±è´¥é¢†åŸŸäº‹ä»¶
â”‚   â””â”€â”€ IArchiveTaskRepository.cs    # å½’æ¡£ä»»åŠ¡ä»“å‚¨æ¥å£
â”œâ”€â”€ DataSources/                     # æ•°æ®æºèšåˆ
â”‚   â”œâ”€â”€ ArchiveDataSource.cs         # æ•°æ®æºå®ä½“
â”‚   â””â”€â”€ IArchiveDataSourceRepository.cs # æ•°æ®æºä»“å‚¨æ¥å£
â”œâ”€â”€ Partitions/                      # åˆ†åŒºé¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ PartitionConfiguration.cs    # åˆ†åŒºé…ç½®èšåˆæ ¹
â”‚   â”œâ”€â”€ PartitionCommand.cs          # åˆ†åŒºå‘½ä»¤å®ä½“
â”‚   â”œâ”€â”€ BackgroundTask.cs    # åˆ†åŒºæ‰§è¡Œä»»åŠ¡å®ä½“
â”‚   â”œâ”€â”€ PartitionBoundary.cs         # åˆ†åŒºè¾¹ç•Œå€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionColumn.cs           # åˆ†åŒºåˆ—å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionTargetTable.cs      # ç›®æ ‡è¡¨å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionFilegroupMapping.cs # æ–‡ä»¶ç»„æ˜ å°„å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionStorageSettings.cs  # å­˜å‚¨è®¾ç½®å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionRetentionPolicy.cs  # ä¿ç•™ç­–ç•¥å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionSafetyRule.cs       # å®‰å…¨è§„åˆ™å®ä½“
â”‚   â”œâ”€â”€ PartitionSafetySnapshot.cs   # å®‰å…¨å¿«ç…§å®ä½“
â”‚   â”œâ”€â”€ PartitionIndexInspection.cs  # ç´¢å¼•æ£€æŸ¥ç»“æœå®ä½“
â”‚   â”œâ”€â”€ PartitionPermissionRequirement.cs # æƒé™éœ€æ±‚å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionAuditLog.cs         # åˆ†åŒºå®¡è®¡æ—¥å¿—å®ä½“
â”‚   â”œâ”€â”€ PartitionExecutionLogEntry.cs # åˆ†åŒºæ‰§è¡Œæ—¥å¿—æ¡ç›®
â”‚   â”œâ”€â”€ TableStatistics.cs           # è¡¨ç»Ÿè®¡ä¿¡æ¯å®ä½“
â”‚   â”œâ”€â”€ PermissionCheckResult.cs     # æƒé™æ£€æŸ¥ç»“æœå€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionValue.cs            # åˆ†åŒºå€¼å€¼å¯¹è±¡
â”‚   â”œâ”€â”€ PartitionCommandType.cs      # åˆ†åŒºå‘½ä»¤ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ PartitionCommandStatus.cs    # åˆ†åŒºå‘½ä»¤çŠ¶æ€æšä¸¾
â”‚   â”œâ”€â”€ PartitionFilegroupStrategy.cs # æ–‡ä»¶ç»„ç­–ç•¥æšä¸¾
â”‚   â”œâ”€â”€ PartitionStorageMode.cs      # åˆ†åŒºå­˜å‚¨æ¨¡å¼æšä¸¾
â”‚   â”œâ”€â”€ PartitionRetentionType.cs    # ä¿ç•™ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ PartitionValueKind.cs        # åˆ†åŒºå€¼ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ IPartitionConfigurationRepository.cs # åˆ†åŒºé…ç½®ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IPartitionCommandRepository.cs # åˆ†åŒºå‘½ä»¤ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IBackgroundTaskRepository.cs # æ‰§è¡Œä»»åŠ¡ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IPartitionCommandQueue.cs    # åˆ†åŒºå‘½ä»¤é˜Ÿåˆ—æ¥å£
â”‚   â”œâ”€â”€ IPartitionMetadataRepository.cs # åˆ†åŒºå…ƒæ•°æ®ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IPermissionInspectionRepository.cs # æƒé™æ£€æŸ¥ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IPartitionAuditLogRepository.cs # å®¡è®¡æ—¥å¿—ä»“å‚¨æ¥å£
â”‚   â”œâ”€â”€ IPartitionExecutionLogRepository.cs # æ‰§è¡Œæ—¥å¿—ä»“å‚¨æ¥å£
â”‚   â””â”€â”€ IPartitionCommandScriptGenerator.cs # åˆ†åŒºè„šæœ¬ç”Ÿæˆå™¨æ¥å£
â”œâ”€â”€ AdminUsers/                      # ç®¡ç†å‘˜ç”¨æˆ·èšåˆ
â””â”€â”€ Abstractions/                    # é¢†åŸŸå±‚æŠ½è±¡
```

#### 5. DbArchiveTool.Infrastructure (åŸºç¡€è®¾æ–½å±‚)
**èŒè´£**: å®ç°æ•°æ®è®¿é—®ã€SQL æ‰§è¡Œã€åå°æœåŠ¡ç­‰æŠ€æœ¯åŸºç¡€è®¾æ–½ã€‚

```
DbArchiveTool.Infrastructure/
â”œâ”€â”€ Persistence/                     # æ•°æ®æŒä¹…åŒ–
â”‚   â”œâ”€â”€ ArchiveDbContext.cs          # EF Core æ•°æ®åº“ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ ArchiveTaskRepository.cs     # å½’æ¡£ä»»åŠ¡ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ PartitionConfigurationRepository.cs # åˆ†åŒºé…ç½®ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ PartitionCommandRepository.cs # åˆ†åŒºå‘½ä»¤ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ BackgroundTaskRepository.cs # æ‰§è¡Œä»»åŠ¡ä»“å‚¨å®ç°
â”‚   â”œâ”€â”€ PartitionAuditLogRepository.cs # å®¡è®¡æ—¥å¿—ä»“å‚¨å®ç°
â”‚   â””â”€â”€ (å…¶ä»–ä»“å‚¨å®ç°)
â”œâ”€â”€ Executors/                       # åˆ†åŒºå‘½ä»¤æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ PartitionExecutionProcessor.cs        # åˆ†åŒºæ‰§è¡Œç¼–æ’å™¨
â”‚   â”œâ”€â”€ SqlPartitionCommandExecutor.cs        # SQL å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ SplitPartitionCommandExecutor.cs      # åˆ†è£‚åˆ†åŒºæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ MergePartitionCommandExecutor.cs      # åˆå¹¶åˆ†åŒºæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ IPartitionCommandExecutor.cs          # æ‰§è¡Œå™¨æ¥å£
â”‚   â”œâ”€â”€ PartitionCommandQueue.cs              # åˆ†åŒºå‘½ä»¤é˜Ÿåˆ—
â”‚   â”œâ”€â”€ PartitionExecutionQueue.cs            # åˆ†åŒºæ‰§è¡Œé˜Ÿåˆ—
â”‚   â”œâ”€â”€ PartitionCommandHostedService.cs      # å‘½ä»¤åå°æœåŠ¡
â”‚   â”œâ”€â”€ PartitionExecutionHostedService.cs    # æ‰§è¡Œåå°æœåŠ¡
â”‚   â”œâ”€â”€ PartitionExecutionDispatcher.cs       # æ‰§è¡Œè°ƒåº¦å™¨
â”‚   â””â”€â”€ PartitionConversionException.cs       # åˆ†åŒºè½¬æ¢å¼‚å¸¸
â”œâ”€â”€ Partitions/                      # åˆ†åŒºåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ SqlServerPartitionMetadataRepository.cs  # SQL Server å…ƒæ•°æ®æŸ¥è¯¢
â”‚   â”œâ”€â”€ SqlServerPermissionInspectionRepository.cs # SQL Server æƒé™æ£€æŸ¥
â”‚   â””â”€â”€ TSqlPartitionCommandScriptGenerator.cs   # T-SQL è„šæœ¬ç”Ÿæˆå™¨
â”œâ”€â”€ SqlExecution/                    # SQL æ‰§è¡ŒæœåŠ¡
â”‚   â”œâ”€â”€ SqlExecutor.cs               # Dapper SQL æ‰§è¡Œå™¨
â”‚   â””â”€â”€ (å…¶ä»– SQL è¾…åŠ©ç±»)
â”œâ”€â”€ SqlTemplates/                    # SQL æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ CreatePartitionFunction.sql  # åˆ›å»ºåˆ†åŒºå‡½æ•°æ¨¡æ¿
â”‚   â”œâ”€â”€ CreatePartitionScheme.sql    # åˆ›å»ºåˆ†åŒºæ–¹æ¡ˆæ¨¡æ¿
â”‚   â”œâ”€â”€ SplitPartition.sql           # åˆ†è£‚åˆ†åŒºæ¨¡æ¿
â”‚   â””â”€â”€ (å…¶ä»– SQL æ¨¡æ¿)
â”œâ”€â”€ Models/                          # åŸºç¡€è®¾æ–½æ¨¡å‹
â”‚   â”œâ”€â”€ TableIndexDefinition.cs      # è¡¨ç´¢å¼•å®šä¹‰æ¨¡å‹
â”‚   â””â”€â”€ (å…¶ä»–å†…éƒ¨æ¨¡å‹)
â”œâ”€â”€ Queries/                         # æŸ¥è¯¢ä¼˜åŒ–
â”œâ”€â”€ Security/                        # å®‰å…¨å®ç°(å¯†ç åŠ å¯†ç­‰)
â”œâ”€â”€ DataSources/                     # æ•°æ®æºåŸºç¡€è®¾æ–½
â”œâ”€â”€ Migrations/                      # EF Core è¿ç§»
â”‚   â””â”€â”€ (è‡ªåŠ¨ç”Ÿæˆçš„è¿ç§»æ–‡ä»¶)
â”œâ”€â”€ Properties/                      # é¡¹ç›®å±æ€§
â””â”€â”€ DependencyInjection.cs           # ä¾èµ–æ³¨å…¥æ‰©å±•
```

#### 6. DbArchiveTool.Shared (å…±äº«ç±»åº“)
**èŒè´£**: æä¾›è·¨é¡¹ç›®çš„é€šç”¨ç±»å‹å’Œè¾…åŠ©ç±»ã€‚

```
DbArchiveTool.Shared/
â”œâ”€â”€ Results/                         # ç»Ÿä¸€ç»“æœç±»å‹
â”‚   â”œâ”€â”€ Result.cs                    # æ“ä½œç»“æœæ³›å‹ç±»
â”‚   â””â”€â”€ PagedResult.cs               # åˆ†é¡µç»“æœç±»
â”œâ”€â”€ Partitions/                      # åˆ†åŒºå…±äº«ç±»å‹
â”‚   â”œâ”€â”€ BackgroundTaskOperationType.cs  # æ‰§è¡Œæ“ä½œç±»å‹æšä¸¾
â”‚   â””â”€â”€ (å…¶ä»–å…±äº«æšä¸¾å’Œå¸¸é‡)
â””â”€â”€ DataSources/                     # æ•°æ®æºå…±äº«ç±»å‹
    â””â”€â”€ (æ•°æ®æºå…±äº«æšä¸¾å’Œå¸¸é‡)
```

---

## ğŸ’¾ æ•°æ®è®¿é—®ç­–ç•¥

### åŒæ•°æ®è®¿é—®æ¨¡å¼

#### EF Core ä»“å‚¨æ¨¡å¼ - é…ç½®ç®¡ç†
**ä½¿ç”¨åœºæ™¯**: å·¥å…·è‡ªèº«çš„é…ç½®ç®¡ç†å’Œä¸šåŠ¡æ•°æ®æŒä¹…åŒ–
**æŠ€æœ¯ç‰¹ç‚¹**: 
- ç±»å‹å®‰å…¨ã€LINQæŸ¥è¯¢
- å˜æ›´è·Ÿè¸ªã€äº‹åŠ¡ç®¡ç†
- ä»£ç ä¼˜å…ˆã€è¿ç§»æ”¯æŒ

**åº”ç”¨èŒƒå›´**:
```csharp
// æ•°æ®æºé…ç½®ç®¡ç†
public interface IDataSourceRepository : IRepository<DataSource>
{
    Task<DataSource> GetByNameAsync(string name);
    Task<List<DataSource>> GetActiveDataSourcesAsync();
}

// å½’æ¡£ä»»åŠ¡ç®¡ç†
public interface IArchiveTaskRepository : IRepository<ArchiveTask>
{
    Task<List<ArchiveTask>> GetPendingTasksAsync();
    Task<List<ArchiveTask>> GetTasksByStatusAsync(TaskStatus status);
}

// æ‰§è¡Œæ—¥å¿—ç®¡ç†
public interface IExecutionLogRepository : IRepository<ExecutionLog>
{
    Task<PagedResult<ExecutionLog>> GetPagedLogsAsync(LogQueryFilter filter);
}
```

### æ—§å·¥å…·æ•°æ®å…¼å®¹ç­–ç•¥

#### æ•°æ®è¿ç§»ä¸å…¼å®¹æ€§
**è¿ç§»åŸåˆ™**: 
- æ—§å·¥å…·æ•°æ®è¡¨ä»ç›®æ ‡æ•°æ®åº“è¿ç§»åˆ°æ–°å·¥å…·è‡ªèº«æ•°æ®åº“
- ä¿æŒæ•°æ®å®Œæ•´æ€§å’Œå†å²è®°å½•è¿ç»­æ€§
- æ”¯æŒå¢é‡åŒæ­¥å’ŒåŒå‘å…¼å®¹

**æ—§è¡¨ç»“æ„æ˜ å°„**:
```csharp
// æ—§å·¥å…·é…ç½®è¡¨ -> æ–°å·¥å…·å®ä½“æ˜ å°„
public class LegacyDataMigrationService
{
    // PartitionArchive_SourceConfiguration -> DataSource + ArchiveConfiguration
    public async Task MigrateSourceConfigurationAsync(string legacyConnectionString)
    {
        var legacyConfigs = await _dapper.QueryAsync<LegacySourceConfiguration>(
            legacyConnectionString, 
            "SELECT * FROM PartitionArchive_SourceConfiguration WHERE OperationStatus = 1");
            
        foreach (var config in legacyConfigs)
        {
            // åˆ›å»ºæ•°æ®æº
            var dataSource = new DataSource
            {
                Name = config.SourceTableName,
                SourceConnection = ExtractSourceConnection(config),
                TargetConnection = ExtractTargetConnection(config),
                LegacyId = config.SourceConfigurationId
            };
            
            // åˆ›å»ºå½’æ¡£é…ç½®
            var archiveConfig = new ArchiveConfiguration
            {
                DataSourceId = dataSource.Id,
                PartitionColumn = config.PartitionColumnName,
                FileGroupMode = (FileGroupMode)config.FileGroupMode,
                EnableAutoArchive = config.EnabledAutoArchive ?? false,
                ArchiveDataType = (ArchiveDataType)config.ArchiveDataType,
                RelativeDays = config.RelativeDays
            };
        }
    }
}
```

#### Dapper åŸç”ŸSQL - å½’æ¡£è„šæœ¬æ‰§è¡Œ
**ä½¿ç”¨åœºæ™¯**: æ•°æ®åº“å½’æ¡£ç›¸å…³çš„å¤æ‚SQLè„šæœ¬æ‰§è¡Œ
**æŠ€æœ¯ç‰¹ç‚¹**: 
- é«˜æ€§èƒ½ã€è½»é‡çº§
- åŸç”ŸSQLæ”¯æŒ
- çµæ´»çš„å‚æ•°åŒ–æŸ¥è¯¢

**åº”ç”¨èŒƒå›´**:
```csharp
// SQL Server åˆ†åŒºæ“ä½œ
public interface ISqlServerPartitionExecutor
{
    Task<bool> CreatePartitionFunctionAsync(string connectionString, CreatePartitionFunctionCommand command);
    Task<bool> SplitPartitionAsync(string connectionString, SplitPartitionCommand command);
    Task<List<PartitionInfo>> GetPartitionInfoAsync(string connectionString, string tableName);
}

// BCP æ•°æ®å¯¼å‡ºå¯¼å…¥
public interface IBcpExecutor 
{
    Task<BcpResult> ExportDataAsync(string connectionString, BcpExportOptions options);
    Task<BcpResult> ImportDataAsync(string connectionString, BcpImportOptions options);
}

// æ•°æ®åº“å…ƒæ•°æ®æŸ¥è¯¢
public interface IMetadataQueryService
{
    Task<List<TableInfo>> GetTablesAsync(string connectionString);
    Task<List<IndexInfo>> GetIndexesAsync(string connectionString, string tableName);
    Task<DatabaseInfo> GetDatabaseInfoAsync(string connectionString);
}
```

---

## ğŸ”— æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. æ•°æ®æºç®¡ç†æ¨¡å—

#### é¢†åŸŸæ¨¡å‹
**æ ¸å¿ƒå®ä½“**: `ArchiveDataSource` (èšåˆæ ¹)

```csharp
/// <summary>å½’æ¡£æ•°æ®æºå®ä½“,è®°å½•æ•°æ®æºè¿æ¥å¿…éœ€ä¿¡æ¯ä¸æè¿°ã€‚</summary>
public sealed class ArchiveDataSource : AggregateRoot
{
    // åŸºç¡€ä¿¡æ¯
    public string Name { get; private set; }              // æ•°æ®æºæ˜¾ç¤ºåç§°
    public string? Description { get; private set; }      // æ•°æ®æºæè¿°
    
    // æºæœåŠ¡å™¨é…ç½®
    public string ServerAddress { get; private set; }     // æœåŠ¡å™¨åœ°å€
    public int ServerPort { get; private set; }           // ç«¯å£å·,é»˜è®¤ 1433
    public string DatabaseName { get; private set; }      // æ•°æ®åº“åç§°
    public bool UseIntegratedSecurity { get; private set; } // æ˜¯å¦ä½¿ç”¨é›†æˆè®¤è¯
    public string? UserName { get; private set; }         // SQL è®¤è¯ç”¨æˆ·å
    public string? Password { get; private set; }         // SQL è®¤è¯å¯†ç (åŠ å¯†å­˜å‚¨)
    
    // ç›®æ ‡æœåŠ¡å™¨é…ç½®
    public bool UseSourceAsTarget { get; private set; }   // æ˜¯å¦ä½¿ç”¨æºæœåŠ¡å™¨ä½œä¸ºç›®æ ‡
    public string? TargetServerAddress { get; private set; }
    public int TargetServerPort { get; private set; }
    public string? TargetDatabaseName { get; private set; }
    public bool TargetUseIntegratedSecurity { get; private set; }
    public string? TargetUserName { get; private set; }
    public string? TargetPassword { get; private set; }   // åŠ å¯†å­˜å‚¨
    
    public bool IsEnabled { get; private set; }           // æ˜¯å¦å¯ç”¨
    
    // é¢†åŸŸæ–¹æ³•
    public void Update(...) { }                           // æ›´æ–°é…ç½®å¹¶éªŒè¯
    public void Enable(string operatorName) { }           // å¯ç”¨æ•°æ®æº
    public void Disable(string operatorName) { }          // ç¦ç”¨æ•°æ®æº
}
```

#### åº”ç”¨æœåŠ¡
**æœåŠ¡æ¥å£**: `IArchiveDataSourceAppService`

```csharp
/// <summary>å½’æ¡£æ•°æ®æºåº”ç”¨æœåŠ¡,è´Ÿè´£æ•°æ®æºçš„å¢åˆ æ”¹æŸ¥ä¸è¿æ¥æµ‹è¯•ã€‚</summary>
public interface IArchiveDataSourceAppService
{
    Task<Result<ArchiveDataSourceDto>> CreateAsync(CreateArchiveDataSourceRequest request);
    Task<Result<ArchiveDataSourceDto>> UpdateAsync(Guid id, UpdateArchiveDataSourceRequest request);
    Task<Result> DeleteAsync(Guid id);
    Task<Result<ArchiveDataSourceDto>> GetByIdAsync(Guid id);
    Task<Result<List<ArchiveDataSourceDto>>> GetAllAsync();
    Task<Result> TestConnectionAsync(Guid id);           // æµ‹è¯•æºæœåŠ¡å™¨è¿æ¥
    Task<Result> TestTargetConnectionAsync(Guid id);     // æµ‹è¯•ç›®æ ‡æœåŠ¡å™¨è¿æ¥
}
```

**å…³é”®å®ç°**:
- **å¯†ç åŠ å¯†**: åˆ›å»º/æ›´æ–°æ—¶è‡ªåŠ¨åŠ å¯†å¯†ç ,ä½¿ç”¨ `IPasswordEncryptionService`
- **è¿æ¥éªŒè¯**: æµ‹è¯•è¿æ¥æ—¶ä¸´æ—¶è§£å¯†å¯†ç ,å»ºç«‹çœŸå®æ•°æ®åº“è¿æ¥éªŒè¯å¯ç”¨æ€§
- **DTO è½¬æ¢**: æŸ¥è¯¢æ—¶ä¸è§£å¯†å¯†ç ,ä¿æŒåŠ å¯†çŠ¶æ€è¿”å›å‰ç«¯

### 2. åˆ†åŒºç®¡ç†æ¨¡å—

#### é¢†åŸŸæ¨¡å‹
**æ ¸å¿ƒå®ä½“**: `PartitionConfiguration` (èšåˆæ ¹)

```csharp
/// <summary>
/// PartitionConfiguration èšåˆæ ¹,æè¿° SQL Server åˆ†åŒºè¡¨çš„é…ç½®ã€è¾¹ç•Œé›†åˆã€
/// æ–‡ä»¶ç»„ç­–ç•¥ä¸å®‰å…¨è§„åˆ™,è´Ÿè´£éªŒè¯è¾¹ç•Œåˆæ³•æ€§å¹¶æä¾›èšåˆè¡Œä¸ºã€‚
/// </summary>
public sealed class PartitionConfiguration : AggregateRoot
{
    // å…³è”å…³ç³»
    public Guid ArchiveDataSourceId { get; }              // å½’æ¡£æ•°æ®æºæ ‡è¯†
    
    // åˆ†åŒºå¯¹è±¡æ ‡è¯†
    public string SchemaName { get; }                     // è¡¨æ¶æ„åç§°
    public string TableName { get; }                      // è¡¨åç§°
    public string PartitionFunctionName { get; }          // åˆ†åŒºå‡½æ•°åç§°
    public string PartitionSchemeName { get; }            // åˆ†åŒºæ–¹æ¡ˆåç§°
    
    // åˆ†åŒºé…ç½®
    public PartitionColumn PartitionColumn { get; }       // åˆ†åŒºåˆ—å®šä¹‰(å€¼å¯¹è±¡)
    public PartitionFilegroupStrategy FilegroupStrategy { get; } // æ–‡ä»¶ç»„ç­–ç•¥
    public PartitionRetentionPolicy? RetentionPolicy { get; } // ä¿ç•™ç­–ç•¥
    public PartitionStorageSettings StorageSettings { get; } // å­˜å‚¨è®¾ç½®
    
    // èšåˆé›†åˆ
    public IReadOnlyCollection<PartitionBoundary> Boundaries { get; } // åˆ†åŒºè¾¹ç•Œåˆ—è¡¨
    public IReadOnlyCollection<PartitionFilegroupMapping> FilegroupMappings { get; } // æ–‡ä»¶ç»„æ˜ å°„
    
    // é¢†åŸŸæ–¹æ³•
    public void AddBoundary(PartitionValue value, string filegroup) { }
    public void RemoveBoundary(PartitionValue value) { }
    public void UpdateStorageSettings(...) { }
    public void UpdateRetentionPolicy(...) { }
}
```

**å€¼å¯¹è±¡**:
- `PartitionColumn`: åˆ†åŒºåˆ—å®šä¹‰(åˆ—åã€æ•°æ®ç±»å‹)
- `PartitionBoundary`: åˆ†åŒºè¾¹ç•Œå€¼(æ”¯æŒå¤šç§ç±»å‹:æ—¥æœŸã€æ•´æ•°ã€å­—ç¬¦ä¸²ç­‰)
- `PartitionStorageSettings`: å­˜å‚¨è®¾ç½®(æ–‡ä»¶å¤§å°ã€å¢é•¿é‡ç­‰)
- `PartitionRetentionPolicy`: ä¿ç•™ç­–ç•¥(ä¿ç•™å¤©æ•°ã€è‡ªåŠ¨æ¸…ç†è§„åˆ™)

#### æ‰§è¡ŒæœåŠ¡
**æ ¸å¿ƒæ‰§è¡Œå™¨**: `PartitionExecutionProcessor`

```csharp
/// <summary>
/// åˆ†åŒºæ‰§è¡Œç¼–æ’å™¨,è´Ÿè´£å®Œæ•´çš„åˆ†åŒºè½¬æ¢/ç»´æŠ¤æµç¨‹ç¼–æ’:
/// 1. æƒé™æ£€æŸ¥  2. ç´¢å¼•æ£€æŸ¥  3. å®‰å…¨å¿«ç…§
/// 4. æ–‡ä»¶ç»„å‡†å¤‡  5. åˆ†åŒºå¯¹è±¡åˆ›å»º  6. è¾¹ç•Œåˆ†è£‚/åˆå¹¶
/// 7. ç´¢å¼•é‡å»º  8. éªŒè¯ä¸æ—¥å¿—
/// </summary>
internal sealed class PartitionExecutionProcessor
{
    public async Task<Result> ExecutePartitionConversionAsync(
        PartitionConfiguration config, 
        string connectionString);
        
    public async Task<Result> ExecuteSplitPartitionAsync(
        PartitionConfiguration config, 
        List<PartitionValue> newBoundaries);
        
    public async Task<Result> ExecuteMergePartitionAsync(
        PartitionConfiguration config, 
        List<PartitionValue> boundariesToRemove);
}
```

**T-SQL ç”Ÿæˆå™¨**: `TSqlPartitionCommandScriptGenerator`
- ç”Ÿæˆåˆ†åŒºå‡½æ•°/æ–¹æ¡ˆåˆ›å»ºè„šæœ¬
- ç”Ÿæˆ ALTER PARTITION FUNCTION SPLIT/MERGE è„šæœ¬
- ç”Ÿæˆç´¢å¼•é‡å»ºè„šæœ¬(è½¬æ¢ä¸ºåˆ†åŒºç´¢å¼•)

**å…ƒæ•°æ®æŸ¥è¯¢**: `SqlServerPartitionMetadataRepository`
- æŸ¥è¯¢ç°æœ‰åˆ†åŒºè¾¹ç•Œ: `ListBoundariesAsync`
- æŸ¥è¯¢è¡¨ç´¢å¼•å®šä¹‰: `ListIndexesAsync`
- æŸ¥è¯¢æ–‡ä»¶ç»„ä¿¡æ¯: `ListFilegroupsAsync`

### 3. å½’æ¡£ä»»åŠ¡æ¨¡å—

#### é¢†åŸŸæ¨¡å‹
**æ ¸å¿ƒå®ä½“**: `ArchiveTask` (èšåˆæ ¹)

```csharp
/// <summary>å½’æ¡£ä»»åŠ¡èšåˆæ ¹,è®°å½•å•æ¬¡å½’æ¡£æ‰§è¡Œçš„å…¨ç”Ÿå‘½å‘¨æœŸä¿¡æ¯ã€‚</summary>
public sealed class ArchiveTask : AggregateRoot
{
    public Guid DataSourceId { get; private set; }        // å…³è”æ•°æ®æº
    public string SourceTableName { get; private set; }   // æ¥æºè¡¨åç§°
    public string TargetTableName { get; private set; }   // ç›®æ ‡è¡¨åç§°
    public ArchiveTaskStatus Status { get; private set; } // ä»»åŠ¡çŠ¶æ€
    public bool IsAutoArchive { get; private set; }       // æ˜¯å¦è‡ªåŠ¨è°ƒåº¦
    
    // æ‰§è¡Œæ—¶é—´è·Ÿè¸ª
    public DateTime? StartedAtUtc { get; private set; }
    public DateTime? CompletedAtUtc { get; private set; }
    
    // æ•°æ®ç»Ÿè®¡
    public long? SourceRowCount { get; private set; }
    public long? TargetRowCount { get; private set; }
    
    // é¢†åŸŸæ–¹æ³•
    public void Start() { }                               // å¼€å§‹æ‰§è¡Œ
    public void Complete(long sourceRows, long targetRows) { }
    public void Fail(string errorMessage) { }
}
```

**ä»»åŠ¡çŠ¶æ€æšä¸¾**:
```csharp
public enum ArchiveTaskStatus
{
    Pending = 0,      // å¾…å¤„ç†
    Running = 1,      // æ‰§è¡Œä¸­
    Completed = 2,    // å·²å®Œæˆ
    Failed = 3,       // å¤±è´¥
    Cancelled = 4     // å·²å–æ¶ˆ
}
```

---

## ğŸ›ï¸ å‰ç«¯æ¶æ„è®¾è®¡

### Blazor Server + AntDesign ç»„ä»¶åº“

#### æŠ€æœ¯æ ˆ
- **Blazor Server**: C# å…¨æ ˆå¼€å‘,æœåŠ¡ç«¯æ¸²æŸ“,SignalR å®æ—¶é€šä¿¡
- **AntDesign Blazor**: ä¼ä¸šçº§ UI ç»„ä»¶åº“,æä¾›ä¸°å¯Œçš„äº¤äº’ç»„ä»¶
- **ç»„ä»¶æ¨¡å¼**: åŸºäºç»„ä»¶çš„é¡µé¢æ„å»º,æ”¯æŒä»£ç åç½®åˆ†ç¦»

#### æ ¸å¿ƒé¡µé¢ç»“æ„

**1. åˆ†åŒºæ‰§è¡Œå‘å¯¼** (`ExecutionWizard.razor`)
```csharp
@page "/partition-executions/wizard/{ConfigId:guid}"
@using AntDesign

<PageHeader Title="åˆ†åŒºæ‰§è¡Œå‘å¯¼" OnBack="@NavigateBack">
    <PageHeaderExtra>
        <Tag Color="@TagColor.Blue">é…ç½®ID: @ConfigId</Tag>
    </PageHeaderExtra>
</PageHeader>

<Spin Spinning="@Loading" Tip="æ­£åœ¨åŠ è½½é…ç½®ä¿¡æ¯...">
    <!-- æ•°æ®æºä¿¡æ¯å±•ç¤º -->
    <Alert Type="@AlertType.Info" ShowIcon="true">
        <MessageTemplate>
            <Descriptions Column="2" Size="@DescriptionsSize.Small">
                <DescriptionsItem Title="æ•°æ®æº">@Context.DataSourceName</DescriptionsItem>
                <DescriptionsItem Title="ç›®æ ‡è¡¨">@Context.FullTableName</DescriptionsItem>
            </Descriptions>
        </MessageTemplate>
    </Alert>
    
    <!-- æ‰§è¡Œè¿›åº¦å±•ç¤º -->
    <Steps Current="@CurrentStep">
        <Step Title="æƒé™æ£€æŸ¥" />
        <Step Title="ç´¢å¼•æ£€æŸ¥" />
        <Step Title="æ‰§è¡Œåˆ†åŒº" />
        <Step Title="å®Œæˆ" />
    </Steps>
</Spin>
```

**2. åˆ†åŒºé…ç½®å‘å¯¼ç»„ä»¶** (`PartitionConfigWizard.razor`)
```csharp
<Drawer Visible="Visible"
        Title="åˆ†åŒºé…ç½®å‘å¯¼"
        Width="760"
        Placement="DrawerPlacement.Right"
        OnClose="HandleDrawerClose">
    <Steps Current="@CurrentStep" Size="@StepsSize.Small">
        <Step Title="åŸºç¡€ä¿¡æ¯" />
        <Step Title="åˆ†åŒºå€¼" />
        <Step Title="å®Œæˆ" />
    </Steps>
    
    <!-- æ­¥éª¤å†…å®¹ -->
    @if (CurrentStep == 0)
    {
        <Form Model="@FormModel">
            <FormItem Label="è¡¨å">
                <Input @bind-Value="@FormModel.TableName" />
            </FormItem>
            <FormItem Label="åˆ†åŒºåˆ—">
                <Select @bind-Value="@FormModel.PartitionColumn">
                    @foreach (var column in AvailableColumns)
                    {
                        <SelectOption Value="@column.Name">@column.Name</SelectOption>
                    }
                </Select>
            </FormItem>
        </Form>
    }
</Drawer>
```

#### ç»„ä»¶è®¾è®¡æ¨¡å¼

**1. ä»£ç åç½®åˆ†ç¦»**
```csharp
// ExecutionWizard.razor.cs
public partial class ExecutionWizard : ComponentBase
{
    [Parameter] public Guid ConfigId { get; set; }
    
    [Inject] private IPartitionExecutionApiClient ExecutionClient { get; set; }
    [Inject] private NavigationManager Navigation { get; set; }
    
    private bool Loading { get; set; } = true;
    private ExecutionContext? Context { get; set; }
    
    protected override async Task OnInitializedAsync()
    {
        await LoadConfigurationAsync();
    }
    
    private async Task LoadConfigurationAsync()
    {
        Loading = true;
        try
        {
            Context = await ExecutionClient.GetExecutionContextAsync(ConfigId);
        }
        finally
        {
            Loading = false;
        }
    }
}
```

**2. çŠ¶æ€ç®¡ç†**
```csharp
// PartitionPageState.cs - é¡µé¢çŠ¶æ€æœåŠ¡
public class PartitionPageState
{
    public event Action? OnChange;
    
    public Guid? SelectedConfigId { get; private set; }
    public string? SearchKeyword { get; private set; }
    
    public void SetSelectedConfig(Guid configId)
    {
        SelectedConfigId = configId;
        NotifyStateChanged();
    }
    
    private void NotifyStateChanged() => OnChange?.Invoke();
}
```

**3. API å®¢æˆ·ç«¯æœåŠ¡**
```csharp
// PartitionExecutionApiClient.cs
public class PartitionExecutionApiClient
{
    private readonly HttpClient _httpClient;
    
    public async Task<ExecutionContext> GetExecutionContextAsync(Guid configId)
    {
        var response = await _httpClient.GetAsync(
            $"/api/v1/partition-executions/{configId}/context");
        response.EnsureSuccessStatusCode();
        return await response.Content.ReadFromJsonAsync<ExecutionContext>();
    }
    
    public async Task<Result> ExecuteAsync(Guid configId)
    {
        var response = await _httpClient.PostAsync(
            $"/api/v1/partition-executions/{configId}/execute", null);
        return await response.Content.ReadFromJsonAsync<Result>();
    }
}
```

#### UI äº¤äº’æ¨¡å¼

**1. è¡¨å•éªŒè¯**
```csharp
<Form Model="@FormModel" OnFinish="@HandleSubmit">
    <FormItem Label="åˆ†åŒºåˆ—" Required>
        <Input @bind-Value="@FormModel.PartitionColumnName"
               Placeholder="è¯·è¾“å…¥åˆ†åŒºåˆ—å" />
    </FormItem>
    
    <FormItem>
        <Button Type="@ButtonType.Primary" HtmlType="submit" Loading="@Submitting">
            æäº¤
        </Button>
    </FormItem>
</Form>
```

**2. æ•°æ®å±•ç¤º**
```csharp
<Table TItem="PartitionConfigDto" 
       DataSource="@Configurations"
       Loading="@Loading"
       OnChange="@HandleTableChange">
    <Column TData="string" @bind-Field="@context.TableName" Title="è¡¨å" />
    <Column TData="int" @bind-Field="@context.BoundaryCount" Title="è¾¹ç•Œæ•°é‡" />
    <ActionColumn Title="æ“ä½œ">
        <Space>
            <SpaceItem>
                <Button Size="@ButtonSize.Small" OnClick="() => Edit(context.Id)">
                    ç¼–è¾‘
                </Button>
            </SpaceItem>
            <SpaceItem>
                <Popconfirm Title="ç¡®å®šåˆ é™¤?" OnConfirm="() => Delete(context.Id)">
                    <Button Size="@ButtonSize.Small" Danger>åˆ é™¤</Button>
                </Popconfirm>
            </SpaceItem>
        </Space>
    </ActionColumn>
</Table>
```

**3. æ¶ˆæ¯åé¦ˆ**
```csharp
// æˆåŠŸæç¤º
await MessageService.Success("åˆ†åŒºåˆ›å»ºæˆåŠŸ!");

// é”™è¯¯æç¤º
await MessageService.Error("æ‰§è¡Œå¤±è´¥: " + errorMessage);

// ç¡®è®¤å¯¹è¯æ¡†
var confirmed = await ConfirmService.Show(
    "ç¡®å®šæ‰§è¡Œåˆ†åŒºè½¬æ¢å—?",
    "æ­¤æ“ä½œå°†é‡å»ºè¡¨ç´¢å¼•,å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´",
    ConfirmButtons.YesNo);
```

#### å¸ƒå±€ä¸å¯¼èˆª

**1. ä¸»å¸ƒå±€** (`MainLayout.razor`)
```csharp
<Layout Style="min-height: 100vh;">
    <Sider Collapsible>
        <Menu Theme="MenuTheme.Dark" Mode="MenuMode.Inline">
            <MenuItem Key="home" RouterLink="/">
                <Icon Type="home" /> é¦–é¡µ
            </MenuItem>
            <SubMenu Key="partition" TitleTemplate="@PartitionMenuTitle">
                <MenuItem Key="partition-configs" RouterLink="/partitions">
                    é…ç½®ç®¡ç†
                </MenuItem>
                <MenuItem Key="partition-executions" RouterLink="/partition-executions">
                    æ‰§è¡Œç›‘æ§
                </MenuItem>
            </SubMenu>
        </Menu>
    </Sider>
    
    <Layout>
        <Header Style="background: #fff; padding: 0;">
            <PageHeader Title="æ•°æ®å½’æ¡£å·¥å…·" />
        </Header>
        <Content Style="margin: 16px;">
            @Body
        </Content>
    </Layout>
</Layout>
```

**2. è·¯ç”±å¯¼èˆª**
```csharp
// ç¼–ç¨‹å¼å¯¼èˆª
Navigation.NavigateTo($"/partition-executions/wizard/{configId}");

// è·¯ç”±å‚æ•°
@page "/partitions/{Id:guid}"
[Parameter] public Guid Id { get; set; }
```

#### æ€§èƒ½ä¼˜åŒ–

**1. è™šæ‹ŸåŒ–é•¿åˆ—è¡¨**
```csharp
<Virtualize Items="@LargeDataSet" Context="item">
    <ItemContent>
        <div>@item.Name</div>
    </ItemContent>
</Virtualize>
```

**2. é˜²æŠ–æœç´¢**
```csharp
private Timer? _searchTimer;

private void OnSearchInput(string value)
{
    _searchTimer?.Dispose();
    _searchTimer = new Timer(_ =>
    {
        InvokeAsync(() => PerformSearch(value));
    }, null, 500, Timeout.Infinite);
}
```

**3. æŒ‰éœ€åŠ è½½**
```csharp
// å»¶è¿ŸåŠ è½½å¤§å‹ç»„ä»¶
@if (ShowDetailPanel)
{
    <DetailPanel Data="@SelectedItem" />
}
```

#### å“åº”å¼è®¾è®¡

```csharp
<Row Gutter="16">
    <AntDesign.Col Xs="24" Sm="12" Md="8" Lg="6">
        <Card Title="ç»Ÿè®¡å¡ç‰‡">å†…å®¹</Card>
    </AntDesign.Col>
</Row>
```

---

## âš™ï¸ é…ç½®å’Œéƒ¨ç½²

### é…ç½®ç®¡ç†
```json
// appsettings.json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=DbArchiveToolDb;Trusted_Connection=true;",
    "Redis": "localhost:6379"
  },
  "ArchiveSettings": {
    "TempDirectory": "C:\\Temp\\DbArchive",
    "MaxConcurrentTasks": 5,
    "DefaultTimeout": "00:30:00"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  }
}
```

### Docker éƒ¨ç½²
```dockerfile
# Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY ["DbArchiveTool.Web/DbArchiveTool.Web.csproj", "DbArchiveTool.Web/"]
RUN dotnet restore "DbArchiveTool.Web/DbArchiveTool.Web.csproj"
COPY . .
WORKDIR "/src/DbArchiveTool.Web"
RUN dotnet build "DbArchiveTool.Web.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "DbArchiveTool.Web.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "DbArchiveTool.Web.dll"]
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### å‘½åçº¦å®š
- **ç±»å**: PascalCase (ä¾‹: `DataSourceService`)
- **æ–¹æ³•å**: PascalCase (ä¾‹: `CreateDataSourceAsync`)
- **å˜é‡å**: camelCase (ä¾‹: `dataSource`)
- **å¸¸é‡**: PascalCase (ä¾‹: `MaxRetryCount`)
- **æ¥å£**: I + PascalCase (ä¾‹: `IDataSourceRepository`)

### ä»£ç ç»„ç»‡
- **å•ä¸€èŒè´£**: æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **ä¾èµ–æ³¨å…¥**: æ‰€æœ‰ä¾èµ–é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥
- **å¼‚æ­¥ä¼˜å…ˆ**: æ‰€æœ‰IOæ“ä½œä½¿ç”¨å¼‚æ­¥æ–¹æ³•
- **å¼‚å¸¸å¤„ç†**: ä½¿ç”¨ Result æ¨¡å¼æ›¿ä»£å¼‚å¸¸ä¼ é€’ä¸šåŠ¡é”™è¯¯

### API è®¾è®¡è§„èŒƒ
```csharp
// RESTful API ç¤ºä¾‹
[ApiController]
[Route("api/[controller]")]
public class DataSourcesController : ControllerBase
{
    [HttpGet]
    public async Task<ActionResult<PagedResult<DataSourceDto>>> GetDataSources(
        [FromQuery] DataSourceQueryFilter filter)
    {
        var result = await _dataSourceService.GetPagedDataSourcesAsync(filter);
        return Ok(result);
    }

    [HttpPost]
    public async Task<ActionResult<DataSourceDto>> CreateDataSource(
        [FromBody] CreateDataSourceDto dto)
    {
        var result = await _dataSourceService.CreateDataSourceAsync(dto);
        if (!result.IsSuccess)
            return BadRequest(result.Error);
            
        return CreatedAtAction(nameof(GetDataSource), new { id = result.Value.Id }, result.Value);
    }
}
```

---

## ğŸ”„ å¼€å‘æµç¨‹

### è¿­ä»£è®¡åˆ’
1. **ç¬¬ä¸€é˜¶æ®µ**: æ ¸å¿ƒæ•°æ®è®¿é—®å±‚ + åŸºç¡€UIæ¡†æ¶
2. **ç¬¬äºŒé˜¶æ®µ**: æ•°æ®æºç®¡ç† + åˆ†åŒºåŸºç¡€åŠŸèƒ½
3. **ç¬¬ä¸‰é˜¶æ®µ**: å½’æ¡£æ‰§è¡Œå¼•æ“ + ç›‘æ§é¢æ¿
4. **ç¬¬å››é˜¶æ®µ**: è°ƒåº¦ç³»ç»Ÿ + é«˜çº§åŠŸèƒ½
5. **ç¬¬äº”é˜¶æ®µ**: æ€§èƒ½ä¼˜åŒ– + éƒ¨ç½²æ”¯æŒ

### æŠ€æœ¯é€‰å‹ç†ç”±

#### .NET 8 + Blazor Server
- **ç»Ÿä¸€æŠ€æœ¯æ ˆ**: C# å…¨æ ˆå¼€å‘ï¼Œå‡å°‘å­¦ä¹ æˆæœ¬
- **å¿«é€Ÿå¼€å‘**: Blazor Server æ— éœ€å‰åç«¯åˆ†ç¦»çš„å¤æ‚æ€§
- **å®æ—¶äº¤äº’**: SignalR å†…ç½®æ”¯æŒï¼Œé€‚åˆä»»åŠ¡è¿›åº¦æ¨é€
- **æ€§èƒ½ä¼˜åŠ¿**: .NET 8 æ€§èƒ½æ˜¾è‘—æå‡

#### Ant Design Blazor
- **ä¼ä¸šçº§UI**: ä¸“ä¸šçš„ä¼ä¸šçº§ç»„ä»¶åº“
- **å®Œæ•´ç”Ÿæ€**: è¡¨æ ¼ã€è¡¨å•ã€å›¾è¡¨ç­‰å…¨å¥—ç»„ä»¶
- **ä¸­æ–‡å‹å¥½**: å®˜æ–¹ä¸­æ–‡æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒ
- **å¿«é€Ÿä¸Šæ‰‹**: ä¸ Ant Design React è®¾è®¡ä¸€è‡´

#### EF Core + Dapper åŒè®¿é—®
- **å„å¸å…¶èŒ**: EF Core å¤„ç†é…ç½®ç®¡ç†ï¼ŒDapper æ‰§è¡Œå½’æ¡£SQL
- **æ€§èƒ½å¹³è¡¡**: åœ¨å¼€å‘æ•ˆç‡å’Œæ‰§è¡Œæ€§èƒ½é—´æ‰¾åˆ°å¹³è¡¡
- **çµæ´»æ€§**: å¤æ‚SQLç”¨Dapperï¼Œä¸šåŠ¡é€»è¾‘ç”¨EF Core

---

## ğŸ”’ å®‰å…¨æ€§è®¾è®¡

### å¯†ç åŠ å¯†æœºåˆ¶

#### å®ç°æ–¹æ¡ˆ
é‡‡ç”¨ **ASP.NET Core Data Protection API** ç¡®ä¿æ•æ„Ÿæ•°æ®å®‰å…¨:

```csharp
/// <summary>
/// å¯†ç åŠ å¯†æœåŠ¡æ¥å£
/// </summary>
public interface IPasswordEncryptionService
{
    string Encrypt(string plainText);
    string Decrypt(string encryptedText);
    bool IsEncrypted(string text);
}
```

#### æŠ€æœ¯ç‰¹ç‚¹
- **åŠ å¯†ç®—æ³•**: AES-256-CBC (ç”± Data Protection API ç®¡ç†)
- **å¯†é’¥ç®¡ç†**: è‡ªåŠ¨å¯†é’¥ç”Ÿæˆã€è½®æ¢å’ŒæŒä¹…åŒ–
- **Purposeéš”ç¦»**: ä½¿ç”¨ `DbArchiveTool.PasswordProtection` ä½œä¸ºåŠ å¯†ç”¨é€”æ ‡è¯†
- **å‘åå…¼å®¹**: é€šè¿‡ `ENCRYPTED:` å‰ç¼€è¯†åˆ«åŠ å¯†çŠ¶æ€,æ”¯æŒæ˜æ–‡åˆ°å¯†æ–‡çš„å¹³æ»‘è¿‡æ¸¡

#### åŠ å¯†æµç¨‹
```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥å¯†ç ] --> B{æ˜¯å¦å·²åŠ å¯†?}
    B -->|å¦| C[è°ƒç”¨Encrypt]
    B -->|æ˜¯| D[ä¿æŒåŸæ ·]
    C --> E[æ·»åŠ ENCRYPTED:å‰ç¼€]
    E --> F[å­˜å‚¨åˆ°æ•°æ®åº“]
    D --> F
```

#### è§£å¯†æµç¨‹
```mermaid
graph LR
    A[ä»æ•°æ®åº“è¯»å–] --> B{æ£€æµ‹ENCRYPTED:å‰ç¼€}
    B -->|æœ‰| C[è°ƒç”¨Decrypt]
    B -->|æ— | D[æ˜æ–‡å¯†ç /å‘åå…¼å®¹]
    C --> E[ç§»é™¤å‰ç¼€å¹¶è§£å¯†]
    E --> F[å»ºç«‹æ•°æ®åº“è¿æ¥]
    D --> F
```

#### åº”ç”¨åœºæ™¯
1. **æ•°æ®æºé…ç½®**:
   - `Password` å­—æ®µ (æºæœåŠ¡å™¨SQLè®¤è¯å¯†ç )
   - `TargetPassword` å­—æ®µ (ç›®æ ‡æœåŠ¡å™¨SQLè®¤è¯å¯†ç )

2. **åŠ å¯†æ—¶æœº**:
   - åˆ›å»ºæ•°æ®æºæ—¶: åœ¨ `ArchiveDataSourceAppService.CreateAsync` ä¸­åŠ å¯†
   - æ›´æ–°æ•°æ®æºæ—¶: åœ¨ `ArchiveDataSourceAppService.UpdateAsync` ä¸­æ£€æµ‹å¹¶åŠ å¯†æ–°å¯†ç 
   - ä¿ç•™åŸå¯†ç : å‰ç«¯ä¼ å…¥ç©ºå€¼æ—¶,ä¿æŒç°æœ‰åŠ å¯†å¯†ç ä¸å˜

3. **è§£å¯†æ—¶æœº**:
   - æµ‹è¯•è¿æ¥æ—¶: åœ¨ `TestConnectionAsync` ä¸­ä¸´æ—¶è§£å¯†ç”¨äºå»ºç«‹è¿æ¥
   - æ‰§è¡Œå½’æ¡£æ—¶: åœ¨æ„å»ºè¿æ¥å­—ç¬¦ä¸²å‰è§£å¯†
   - **ä¸è§£å¯†åœºæ™¯**: DTOä¼ è¾“ã€æ—¥å¿—è®°å½•ã€é¡µé¢æ˜¾ç¤º (ä¿æŒåŠ å¯†çŠ¶æ€)

#### æ•°æ®è¿ç§»
å¯¹äºç°æœ‰æ˜æ–‡å¯†ç ,æä¾›è¿ç§»å·¥å…· `tools/EncryptPasswords`:

```bash
# è¿è¡Œå¯†ç åŠ å¯†è¿ç§»å·¥å…·
cd tools/EncryptPasswords
dotnet run "Server=localhost;Database=DbArchiveTool;Trusted_Connection=True"
```

**è¿ç§»ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ£€æµ‹å¹¶è·³è¿‡å·²åŠ å¯†å¯†ç 
- âœ… æ‰¹é‡å¤„ç†æ‰€æœ‰æ•°æ®æº
- âœ… è¯¦ç»†çš„è¿ç§»æ—¥å¿—è¾“å‡º
- âœ… å¹‚ç­‰æ“ä½œ (å¯å®‰å…¨é‡å¤è¿è¡Œ)

#### ç”Ÿäº§ç¯å¢ƒé…ç½®
```csharp
// Program.cs - é…ç½®æŒä¹…åŒ–å¯†é’¥å­˜å‚¨
services.AddDataProtection()
    .PersistKeysToFileSystem(new DirectoryInfo(@"\\shared\keys"))
    .SetApplicationName("DbArchiveTool")
    .ProtectKeysWithDpapi(); // Windowsç¯å¢ƒä½¿ç”¨DPAPIä¿æŠ¤å¯†é’¥
```

**æ³¨æ„äº‹é¡¹**:
âš ï¸ **å¯†é’¥ç®¡ç†**: 
- å¼€å‘ç¯å¢ƒ: å¯†é’¥å­˜å‚¨åœ¨ç”¨æˆ·é…ç½®æ–‡ä»¶ `%LOCALAPPDATA%\ASP.NET\DataProtection-Keys`
- ç”Ÿäº§ç¯å¢ƒ: å¿…é¡»é…ç½®å…±äº«å¯†é’¥å­˜å‚¨ (æ–‡ä»¶ç³»ç»Ÿã€Azure Key Vaultã€Redisç­‰)
- å¯†é’¥ä¸¢å¤±: å°†å¯¼è‡´æ‰€æœ‰åŠ å¯†å¯†ç æ— æ³•è§£å¯†,éœ€è¦é‡æ–°é…ç½®æ•°æ®æº

âš ï¸ **å®‰å…¨å®¡è®¡**:
- å¯†ç ä»…åœ¨å†…å­˜ä¸­çŸ­æš‚è§£å¯†
- è§£å¯†åçš„å¯†ç ä¸å†™å…¥æ—¥å¿—
- APIå“åº”ä¸­ä¸åŒ…å«è§£å¯†åçš„å¯†ç 
- æ•°æ®åº“ä¸­æ°¸ä¹…å­˜å‚¨åŠ å¯†å¯†ç 

### å…¶ä»–å®‰å…¨æªæ–½
- **è¿æ¥å­—ç¬¦ä¸²å®‰å…¨**: æ•æ„Ÿé…ç½®ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- **SQLæ³¨å…¥é˜²æŠ¤**: Dapperå‚æ•°åŒ–æŸ¥è¯¢,ç¦æ­¢å­—ç¬¦ä¸²æ‹¼æ¥SQL
- **HTTPSå¼ºåˆ¶**: ç”Ÿäº§ç¯å¢ƒå¼ºåˆ¶HTTPS,ä¿æŠ¤ä¼ è¾“å±‚æ•°æ®
- **CORSç­–ç•¥**: APIé…ç½®ä¸¥æ ¼çš„è·¨åŸŸè®¿é—®ç­–ç•¥
- **è®¤è¯æˆæƒ**: åŸºäºJWTæˆ–Cookieçš„èº«ä»½éªŒè¯æœºåˆ¶

---

*æœ¬æ¶æ„è®¾è®¡éµå¾ªç²¾ç®€ã€å®ç”¨ã€å¿«é€Ÿè¿­ä»£çš„åŸåˆ™,ä¸ºæ–°æ•°æ®åº“å½’æ¡£å·¥å…·æä¾›äº†æ¸…æ™°çš„æŠ€æœ¯æ–¹æ¡ˆå’Œå¼€å‘æŒ‡å¯¼ã€‚å®‰å…¨æ€§è®¾è®¡ç¡®ä¿æ•æ„Ÿæ•°æ®å¾—åˆ°å……åˆ†ä¿æŠ¤,ç¬¦åˆä¼ä¸šçº§åº”ç”¨çš„å®‰å…¨æ ‡å‡†ã€‚*
